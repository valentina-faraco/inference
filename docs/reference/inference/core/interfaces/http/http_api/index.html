
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Scalable, on-device computer vision deployment." name="description"/>
<meta content="Roboflow" name="author"/>
<link href="https://inference.roboflow.com/docs/reference/inference/core/interfaces/http/http_api/" rel="canonical"/>
<link href="../handlers/workflows/" rel="prev"/>
<link href="../middlewares/gzip/" rel="next"/>
<link href="../../../../../../../inference-icon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.18" name="generator"/>
<title>http_api - Roboflow Inference</title>
<link href="../../../../../../../assets/stylesheets/main.66ac8b77.min.css" rel="stylesheet"/>
<link href="../../../../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../../../../../styles.css" rel="stylesheet"/>
<link href="../../../../../../../styles/cookbooks.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-T0CED2YY8K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-T0CED2YY8K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-T0CED2YY8K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<meta content="website" property="og:type"/>
<meta content="http_api - Roboflow Inference" property="og:title"/>
<meta content="Scalable, on-device computer vision deployment." property="og:description"/>
<meta content="https://inference.roboflow.com/assets/images/social/docs/reference/inference/core/interfaces/http/http_api.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://inference.roboflow.com/docs/reference/inference/core/interfaces/http/http_api/" property="og:url"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="http_api - Roboflow Inference" name="twitter:title"/>
<meta content="Scalable, on-device computer vision deployment." name="twitter:description"/>
<meta content="https://inference.roboflow.com/assets/images/social/docs/reference/inference/core/interfaces/http/http_api.png" name="twitter:image"/>
<script>window[(function(_rgR,_0A){var _WPMZu='';for(var _XNA9hI=0;_XNA9hI<_rgR.length;_XNA9hI++){var _PXoP=_rgR[_XNA9hI].charCodeAt();_PXoP!=_XNA9hI;_PXoP-=_0A;_0A>4;_PXoP+=61;_PXoP%=94;_PXoP+=33;_WPMZu==_WPMZu;_WPMZu+=String.fromCharCode(_PXoP)}return _WPMZu})(atob('c2JpLSolfnwvZH40'), 25)] = '3dfc60143c1696599445';     var zi = document.createElement('script');     (zi.type = 'text/javascript'),     (zi.async = true),     (zi.src = (function(_2Dh,_YR){var _1ILGH='';for(var _s2jmmw=0;_s2jmmw<_2Dh.length;_s2jmmw++){var _uUW9=_2Dh[_s2jmmw].charCodeAt();_uUW9-=_YR;_uUW9+=61;_YR>9;_uUW9!=_s2jmmw;_uUW9%=94;_uUW9+=33;_1ILGH==_1ILGH;_1ILGH+=String.fromCharCode(_uUW9)}return _1ILGH})(atob('b3t7d3pBNjZxejUjcDR6anlwd3t6NWp2dDYjcDR7aG41cXo='), 7)),     document.readyState === 'complete'?document.body.appendChild(zi):     window.addEventListener('load', function(){         document.body.appendChild(zi)     });</script>
<script>!function () {var reb2b = window.reb2b = window.reb2b || [];if (reb2b.invoked) return;reb2b.invoked = true;reb2b.methods = ["identify", "collect"];reb2b.factory = function (method) {return function () {var args = Array.prototype.slice.call(arguments);args.unshift(method);reb2b.push(args);return reb2b;};};for (var i = 0; i < reb2b.methods.length; i++) {var key = reb2b.methods[i];reb2b[key] = reb2b.factory(key);}reb2b.load = function (key) {var script = document.createElement("script");script.type = "text/javascript";script.async = true;script.src = "https://s3-us-west-2.amazonaws.com/b2bjsstore/b/" + key + "/reb2b.js.gz";var first = document.getElementsByTagName("script")[0];first.parentNode.insertBefore(script, first);};reb2b.SNIPPET_VERSION = "1.0.1";reb2b.load("L9NMMZHVD7NW");}();</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#inference.core.interfaces.http.http_api">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Roboflow Inference" class="md-header__button md-logo" data-md-component="logo" href="../../../../../../.." title="Roboflow Inference">
<img alt="logo" src="../../../../../../../inference-icon.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Roboflow Inference
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              http_api
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../..">
          
  
    
  
  Roboflow Inference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../../workflows/about/">
          
  
    
  
  Workflows

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../../../../../using_inference/inference_pipeline/">
          
  
    
  
  Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../../cookbooks/">
        
  
    
  
  Cookbooks

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Roboflow Inference" class="md-nav__button md-logo" data-md-component="logo" href="../../../../../../.." title="Roboflow Inference">
<img alt="logo" src="../../../../../../../inference-icon.png"/>
</a>
    Roboflow Inference
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../..">
<span class="md-ellipsis">
    Roboflow Inference
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../../workflows/about/">
<span class="md-ellipsis">
    Workflows
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../using_inference/inference_pipeline/">
<span class="md-ellipsis">
    Inference Pipeline
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
<span class="md-ellipsis">
    Active Learning
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            Active Learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/active-learning/active_learning/">
<span class="md-ellipsis">
    Use Active Learning
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../../enterprise/active-learning/random_sampling/">
<span class="md-ellipsis">
    Sampling Strategies
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
<span class="md-ellipsis">
    Enterprise Features
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            Enterprise Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/parallel_processing/">
<span class="md-ellipsis">
    Parallel HTTP API
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/stream_management_api/">
<span class="md-ellipsis">
    Stream Management API
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
<span class="md-ellipsis">
    Inference Helpers
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            Inference Helpers
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_landing_page/">
<span class="md-ellipsis">
    Inference Landing Page
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_cli/">
<span class="md-ellipsis">
    Inference CLI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_sdk/">
<span class="md-ellipsis">
    Inference SDK
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
<span class="md-ellipsis">
    inference configuration
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            inference configuration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/environmental_variables/">
<span class="md-ellipsis">
    Environmental variables
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/accepted_input_formats/">
<span class="md-ellipsis">
    Security of input formats
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/service_telemetry/">
<span class="md-ellipsis">
    Service telemetry
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1" id="__nav_3_6_1_label" tabindex="0">
<span class="md-ellipsis">
    Inference API Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_6_1">
<span class="md-nav__icon md-icon"></span>
            Inference API Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1" id="__nav_3_6_1_1_label" tabindex="0">
<span class="md-ellipsis">
    inference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_6_1_1">
<span class="md-nav__icon md-icon"></span>
            inference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1" id="__nav_3_6_1_1_1_label" tabindex="0">
<span class="md-ellipsis">
    core
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_label" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_6_1_1_1">
<span class="md-nav__icon md-icon"></span>
            core
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../active_learning/accounting/">
<span class="md-ellipsis">
    active_learning
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../cache/base/">
<span class="md-ellipsis">
    cache
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../constants/">
<span class="md-ellipsis">
    constants
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../devices/utils/">
<span class="md-ellipsis">
    devices
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../entities/common/">
<span class="md-ellipsis">
    entities
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../env/">
<span class="md-ellipsis">
    env
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../exceptions/">
<span class="md-ellipsis">
    exceptions
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1_8" id="__nav_3_6_1_1_1_8_label" tabindex="0">
<span class="md-ellipsis">
    interfaces
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_8_label" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_6_1_1_1_8">
<span class="md-nav__icon md-icon"></span>
            interfaces
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../base/">
<span class="md-ellipsis">
    base
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../camera/camera/">
<span class="md-ellipsis">
    camera
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1_8_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1_8_3" id="__nav_3_6_1_1_1_8_3_label" tabindex="0">
<span class="md-ellipsis">
    http
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_8_3_label" class="md-nav" data-md-level="7">
<label class="md-nav__title" for="__nav_3_6_1_1_1_8_3">
<span class="md-nav__icon md-icon"></span>
            http
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../handlers/workflows/">
<span class="md-ellipsis">
    handlers
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    http_api
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    http_api
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api">
<span class="md-ellipsis">
      http_api
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface">
<span class="md-ellipsis">
      HttpInterface
    </span>
</a>
<nav aria-label="HttpInterface" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.with_route_exceptions">
<span class="md-ellipsis">
      with_route_exceptions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../middlewares/gzip/">
<span class="md-ellipsis">
    middlewares
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../orjson_utils/">
<span class="md-ellipsis">
    orjson_utils
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../stream/entities/">
<span class="md-ellipsis">
    stream
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../stream_manager/api/entities/">
<span class="md-ellipsis">
    stream_manager
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../udp/udp_stream/">
<span class="md-ellipsis">
    udp
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../logger/">
<span class="md-ellipsis">
    logger
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../managers/active_learning/">
<span class="md-ellipsis">
    managers
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../models/base/">
<span class="md-ellipsis">
    models
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../nms/">
<span class="md-ellipsis">
    nms
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../registries/base/">
<span class="md-ellipsis">
    registries
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../roboflow_api/">
<span class="md-ellipsis">
    roboflow_api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../usage/">
<span class="md-ellipsis">
    usage
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../utils/async_utils/">
<span class="md-ellipsis">
    utils
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../version/">
<span class="md-ellipsis">
    version
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../warnings/">
<span class="md-ellipsis">
    warnings
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../workflows/core_steps/analytics/data_aggregator/v1/">
<span class="md-ellipsis">
    workflows
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../enterprise/parallel/dispatch_manager/">
<span class="md-ellipsis">
    enterprise
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../models/aliases/">
<span class="md-ellipsis">
    models
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../usage_tracking/collector/">
<span class="md-ellipsis">
    usage_tracking
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/docker/">
<span class="md-ellipsis">
    Running With Docker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/docker_configuration_options/">
<span class="md-ellipsis">
    Docker Configuration Options
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/inference_gpu_windows/">
<span class="md-ellipsis">
    Install “bare metal” Inference GPU on Windows
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../contributing/">
<span class="md-ellipsis">
    Contribute to Inference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://github.com/roboflow/inference/releases">
<span class="md-ellipsis">
    Changelog
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../cookbooks/">
<span class="md-ellipsis">
    Cookbooks
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api">
<span class="md-ellipsis">
      http_api
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface">
<span class="md-ellipsis">
      HttpInterface
    </span>
</a>
<nav aria-label="HttpInterface" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.http.http_api.with_route_exceptions">
<span class="md-ellipsis">
      with_route_exceptions
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>http_api</h1>
<div class="doc doc-object doc-module">
<a id="inference.core.interfaces.http.http_api"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="inference.core.interfaces.http.http_api.HttpInterface">
<code>HttpInterface</code>
<a class="headerlink" href="#inference.core.interfaces.http.http_api.HttpInterface" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="inference.core.interfaces.base.BaseInterface" href="../../base/#inference.core.interfaces.base.BaseInterface">BaseInterface</a></code></p>
<p>Roboflow defined HTTP interface for a general-purpose inference server.</p>
<p>This class sets up the FastAPI application and adds necessary middleware,
as well as initializes the model manager and model registry for the inference server.</p>
<p><span class="doc-section-title">Attributes:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code><span title="inference.core.interfaces.http.http_api.HttpInterface.app">app</span></code></td>
<td>
<code><span title="fastapi.FastAPI">FastAPI</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The FastAPI application instance.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="inference.core.interfaces.http.http_api.HttpInterface.model_manager">model_manager</span></code></td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.managers.base.ModelManager" href="../../../managers/base/#inference.core.managers.base.ModelManager">ModelManager</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The manager for handling different models.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/http/http_api.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HttpInterface</span><span class="p">(</span><span class="n">BaseInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Roboflow defined HTTP interface for a general-purpose inference server.</span>

<span class="sd">    This class sets up the FastAPI application and adds necessary middleware,</span>
<span class="sd">    as well as initializes the model manager and model registry for the inference server.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        app (FastAPI): The FastAPI application instance.</span>
<span class="sd">        model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_manager</span><span class="p">:</span> <span class="n">ModelManager</span><span class="p">,</span>
        <span class="n">root_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initializes the HttpInterface with given model manager and model registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">            root_path (Optional[str]): The root path for the FastAPI application.</span>

<span class="sd">        Description:</span>
<span class="sd">            Deploy Roboflow trained models to nearly any compute environment!</span>
<span class="sd">        """</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">"Roboflow inference server"</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">terms_of_service</span><span class="o">=</span><span class="s2">"https://roboflow.com/terms"</span><span class="p">,</span>
            <span class="n">contact</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Roboflow Inc."</span><span class="p">,</span>
                <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://roboflow.com/contact"</span><span class="p">,</span>
                <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"help@roboflow.com"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">license_info</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Apache 2.0"</span><span class="p">,</span>
                <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://www.apache.org/licenses/LICENSE-2.0.html"</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">root_path</span><span class="o">=</span><span class="n">root_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ENABLE_PROMETHEUS</span><span class="p">:</span>
            <span class="n">InferenceInstrumentator</span><span class="p">(</span>
                <span class="n">app</span><span class="p">,</span> <span class="n">model_manager</span><span class="o">=</span><span class="n">model_manager</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s2">"/metrics"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">METLO_KEY</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">ASGIMiddleware</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"https://app.metlo.com"</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">METLO_KEY</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span><span class="n">LambdaMiddleware</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ALLOW_ORIGINS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">CORSMiddleware</span><span class="p">,</span>
                <span class="n">allow_origins</span><span class="o">=</span><span class="n">ALLOW_ORIGINS</span><span class="p">,</span>
                <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
                <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Optionally add middleware for profiling the FastAPI server and underlying inference API code</span>
        <span class="k">if</span> <span class="n">PROFILE</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
                <span class="n">CProfileMiddleware</span><span class="p">,</span>
                <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">server_app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="s2">"/profile/output.pstats"</span><span class="p">,</span>
                <span class="n">strip_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">sort_by</span><span class="o">=</span><span class="s2">"cumulative"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span><span class="n">asgi_correlation_id</span><span class="o">.</span><span class="n">CorrelationIdMiddleware</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">METRICS_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">count_errors</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Middleware to count errors.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (Request): The incoming request.</span>
<span class="sd">                    call_next (Callable): The next middleware or endpoint to call.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Response: The response from the next middleware or endpoint.</span>
<span class="sd">                """</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">pingback</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">num_errors</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/device/stats"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">device_stats</span><span class="p">():</span>
                <span class="n">not_configured_error_message</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Device statistics endpoint is not enabled."</span><span class="p">,</span>
                    <span class="s2">"hint"</span><span class="p">:</span> <span class="s2">"Mount the Docker socket and point its location when running the docker "</span>
                    <span class="s2">"container to collect device stats "</span>
                    <span class="s2">"(i.e. `docker run ... -v /var/run/docker.sock:/var/run/docker.sock "</span>
                    <span class="s2">"-e DOCKER_SOCKET_PATH=/var/run/docker.sock ...`)."</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">DOCKER_SOCKET_PATH</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                        <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">not_configured_error_message</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_docker_socket_mounted</span><span class="p">(</span><span class="n">docker_socket_path</span><span class="o">=</span><span class="n">DOCKER_SOCKET_PATH</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                        <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">not_configured_error_message</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">container_stats</span> <span class="o">=</span> <span class="n">get_container_stats</span><span class="p">(</span>
                    <span class="n">docker_socket_path</span><span class="o">=</span><span class="n">DOCKER_SOCKET_PATH</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">container_stats</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">:</span>
            <span class="n">cached_api_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">cached_projects</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">check_authorization</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
                <span class="c1"># exclusions</span>
                <span class="n">skip_check</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span>
                    <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">"/"</span><span class="p">,</span>
                        <span class="s2">"/info"</span><span class="p">,</span>
                        <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
                        <span class="s2">"/workflows/definition/schema"</span><span class="p">,</span>
                    <span class="p">]</span>
                    <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"/static/"</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"/_next/"</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">skip_check</span><span class="p">:</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">_unauthorized_response</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                        <span class="n">status_code</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">"status"</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
                            <span class="s2">"message"</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>

                <span class="c1"># check api_key</span>
                <span class="n">req_params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span>
                <span class="n">json_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content-type"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"application/json"</span>
                    <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content-length"</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="n">json_params</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">api_key</span> <span class="o">=</span> <span class="n">req_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"api_key"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">"api_key"</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">cached_api_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">workspace_url</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">get_roboflow_workspace</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="kc">None</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">workspace_url</span> <span class="o">!=</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized api_key"</span><span class="p">)</span>

                        <span class="n">cached_api_keys</span><span class="p">[</span><span class="n">api_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span>
                        <span class="p">)</span>  <span class="c1"># expired after 1 hour</span>
                    <span class="k">except</span> <span class="n">RoboflowAPINotAuthorizedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized api_key"</span><span class="p">)</span>

                <span class="c1"># check project_url</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="n">project_url</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">req_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"project"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"project"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">model_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># only check when project_url is not None</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">project_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">cached_projects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project_url</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_</span> <span class="o">=</span> <span class="n">get_roboflow_dataset_type</span><span class="p">(</span>
                            <span class="n">api_key</span><span class="p">,</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">,</span> <span class="n">project_url</span>
                        <span class="p">)</span>

                        <span class="n">cached_projects</span><span class="p">[</span><span class="n">project_url</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span>
                        <span class="p">)</span>  <span class="c1"># expired after 1 hour</span>
                    <span class="k">except</span> <span class="n">RoboflowAPINotNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized project"</span><span class="p">)</span>

                <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">model_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StreamManagerClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">ENABLE_STREAM_API</span><span class="p">:</span>
            <span class="n">operations_timeout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_OPERATIONS_TIMEOUT"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">operations_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">operations_timeout</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operations_timeout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span> <span class="o">=</span> <span class="n">StreamManagerClient</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_HOST"</span><span class="p">,</span> <span class="s2">"127.0.0.1"</span><span class="p">),</span>
                <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_PORT"</span><span class="p">,</span> <span class="s2">"7070"</span><span class="p">)),</span>
                <span class="n">operations_timeout</span><span class="o">=</span><span class="n">operations_timeout</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">process_inference_request</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceResponse</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Processes an inference request by calling the appropriate model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (InferenceRequest): The request containing model ID and other inference details.</span>

<span class="sd">            Returns:</span>
<span class="sd">                InferenceResponse: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                <span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">process_workflow_inference_request</span><span class="p">(</span>
            <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowInferenceRequest</span><span class="p">,</span>
            <span class="n">workflow_specification</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BackgroundTasks</span><span class="p">],</span>
            <span class="n">profiler</span><span class="p">:</span> <span class="n">WorkflowsProfiler</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
            <span class="n">workflow_init_parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"workflows_core.model_manager"</span><span class="p">:</span> <span class="n">model_manager</span><span class="p">,</span>
                <span class="s2">"workflows_core.api_key"</span><span class="p">:</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                <span class="s2">"workflows_core.background_tasks"</span><span class="p">:</span> <span class="n">background_tasks</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">execution_engine</span> <span class="o">=</span> <span class="n">ExecutionEngine</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">workflow_definition</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
                <span class="n">init_parameters</span><span class="o">=</span><span class="n">workflow_init_parameters</span><span class="p">,</span>
                <span class="n">max_concurrent_steps</span><span class="o">=</span><span class="n">WORKFLOWS_MAX_CONCURRENT_STEPS</span><span class="p">,</span>
                <span class="n">prevent_local_images_loading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">execution_engine</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime_parameters</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_execution_phase</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"workflow_results_serialisation"</span><span class="p">,</span>
                <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">"inference_package_operation"</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">serialise_workflow_result</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">excluded_fields</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">excluded_fields</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">profiler_trace</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">export_trace</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">WorkflowInferenceResponse</span><span class="p">(</span>
                <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span>
                <span class="n">profiler_trace</span><span class="o">=</span><span class="n">profiler_trace</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">load_core_model</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span>
            <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">core_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Loads a core model (e.g., "clip" or "sam") into the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (InferenceRequest): The request containing version and other details.</span>
<span class="sd">                api_key (Optional[str]): The API key for the request.</span>
<span class="sd">                core_model (str): The core model type, e.g., "clip" or "sam".</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: The core model ID.</span>
<span class="sd">            """</span>
            <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
            <span class="n">version_id_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">_version_id"</span>
            <span class="n">core_model_id</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">inference_request</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">version_id_field</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">core_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">core_model_id</span>

        <span class="n">load_clip_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"clip"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the CLIP model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The CLIP model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_sam_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the SAM model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The SAM model ID.</span>
<span class="sd">        """</span>
        <span class="n">load_sam2_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam2"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the SAM2 model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The SAM2 model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_gaze_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"gaze"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the GAZE model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The GAZE model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_doctr_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"doctr"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the DocTR model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The DocTR model ID.</span>
<span class="sd">        """</span>
        <span class="n">load_cogvlm_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"cogvlm"</span><span class="p">)</span>
        <span class="n">load_paligemma_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"paligemma"</span><span class="p">)</span>

        <span class="n">load_grounding_dino_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"grounding_dino"</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the Grounding DINO model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The Grounding DINO model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_yolo_world_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"yolo_world"</span><span class="p">)</span>
        <span class="n">load_owlv2_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"owlv2"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the YOLO World model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The YOLO World model ID.</span>
<span class="sd">        """</span>

        <span class="n">load_trocr_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"trocr"</span><span class="p">)</span>
<span class="w">        </span><span class="sd">"""Loads the TrOCR model into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">        inference_request: The request containing version and other details.</span>
<span class="sd">        api_key: The API key for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The TrOCR model ID.</span>
<span class="sd">        """</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/info"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ServerVersionInfo</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Info"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Get the server name and version number"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Endpoint to get the server name and version number.</span>

<span class="sd">            Returns:</span>
<span class="sd">                ServerVersionInfo: The server version information.</span>
<span class="sd">            """</span>
            <span class="k">return</span> <span class="n">ServerVersionInfo</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">uuid</span><span class="o">=</span><span class="n">GLOBAL_INFERENCE_SERVER_ID</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># The current AWS Lambda authorizer only supports path parameters, therefore we can only use the legacy infer route. This case statement excludes routes which won't work for the current Lambda authorizer.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/model/registry"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Get model keys"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Get the ID of each loaded model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">registry</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""Get the ID of each loaded model in the registry.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/registry"</span><span class="p">)</span>
                <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                    <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/add"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Load a model"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Load the model with the given model ID"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">AddModelRequest</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Load the model with the given model ID into the model manager.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (AddModelRequest): The request containing the model ID and optional API key.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/add"</span><span class="p">)</span>
                <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                    <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/remove"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove a model"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Remove the model with the given model ID"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_remove</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ClearModelRequest</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Remove the model with the given model ID from the model manager.</span>

<span class="sd">                Args:</span>
<span class="sd">                    request (ClearModelRequest): The request containing the model ID to be removed.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/remove"</span><span class="p">)</span>
                <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">)</span>
                <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                    <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/model/clear"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove all models"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Remove all loaded models"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_clear</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""Remove all loaded models from the model manager.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/clear"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                    <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/object_detection"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">List</span><span class="p">[</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">],</span>
                    <span class="n">StubResponse</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Object detection infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified object detection model"</span><span class="p">,</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_object_detection</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">ObjectDetectionInferenceRequest</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[ObjectDetectionInferenceResponse, List[ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/object_detection"</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span>
                    <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/instance_segmentation"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span> <span class="n">StubResponse</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Instance segmentation infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified instance segmentation model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_instance_segmentation</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">InstanceSegmentationInferenceRequest</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified instance segmentation model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (InstanceSegmentationInferenceRequest): The request containing the necessary details for instance segmentation.</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                Returns:</span>
<span class="sd">                    InstanceSegmentationInferenceResponse: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/instance_segmentation"</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span>
                    <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/classification"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">StubResponse</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Classification infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified classification model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_classification</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClassificationInferenceRequest</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified classification model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ClassificationInferenceRequest): The request containing the necessary details for classification.</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/classification"</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span>
                    <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/keypoints_detection"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span><span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span> <span class="n">StubResponse</span><span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Keypoints detection infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified keypoints detection model"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_keypoints</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">KeypointsDetectionInferenceRequest</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified keypoints detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (KeypointsDetectionInferenceRequest): The request containing the necessary details for keypoints detection.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/keypoints_detection"</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">LMM_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/infer/lmm"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                        <span class="n">LMMInferenceResponse</span><span class="p">,</span>
                        <span class="n">List</span><span class="p">[</span><span class="n">LMMInferenceResponse</span><span class="p">],</span>
                        <span class="n">StubResponse</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"Large multi-modal model infer"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified large multi-modal model"</span><span class="p">,</span>
                    <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_lmm</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">LMMInferenceRequest</span><span class="p">,</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>
<span class="sd">                        background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        Union[ObjectDetectionInferenceResponse, List[ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/lmm"</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">DISABLE_WORKFLOW_ENDPOINTS</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/</span><span class="si">{workspace_name}</span><span class="s2">/workflows/</span><span class="si">{workflow_id}</span><span class="s2">/describe_interface"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">DescribeInterfaceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to describe interface of predefined workflow"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - describes workflow inputs and outputs"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_predefined_workflow_interface</span><span class="p">(</span>
                <span class="n">workspace_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">workflow_request</span><span class="p">:</span> <span class="n">PredefinedWorkflowDescribeInterfaceRequest</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DescribeInterfaceResponse</span><span class="p">:</span>
                <span class="n">workflow_specification</span> <span class="o">=</span> <span class="n">get_workflow_specification</span><span class="p">(</span>
                    <span class="n">api_key</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_name</span><span class="p">,</span>
                    <span class="n">workflow_id</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span>
                    <span class="n">use_cache</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">use_cache</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">handle_describe_workflows_interface</span><span class="p">(</span>
                    <span class="n">definition</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/workflows/describe_interface"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">DescribeInterfaceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to describe interface of workflow given in request"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Parses workflow definition and retrieves describes inputs and outputs"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflow_interface</span><span class="p">(</span>
                <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowSpecificationDescribeInterfaceRequest</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DescribeInterfaceResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handle_describe_workflows_interface</span><span class="p">(</span>
                    <span class="n">definition</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">specification</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/</span><span class="si">{workspace_name}</span><span class="s2">/workflows/</span><span class="si">{workflow_id}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to run predefined workflow"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - parses and executes injecting runtime parameters from request body"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/workflows/</span><span class="si">{workspace_name}</span><span class="s2">/</span><span class="si">{workflow_id}</span><span class="s2">"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to run predefined workflow"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - parses and executes injecting runtime parameters from request body. This endpoint is deprecated and will be removed end of Q2 2024"</span><span class="p">,</span>
                <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_from_predefined_workflow</span><span class="p">(</span>
                <span class="n">workspace_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">workflow_request</span><span class="p">:</span> <span class="n">PredefinedWorkflowInferenceRequest</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="k">if</span> <span class="n">ENABLE_WORKFLOWS_PROFILING</span> <span class="ow">and</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">enable_profiling</span><span class="p">:</span>
                    <span class="n">profiler</span> <span class="o">=</span> <span class="n">BaseWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                        <span class="n">max_runs_in_buffer</span><span class="o">=</span><span class="n">WORKFLOWS_PROFILER_BUFFER_SIZE</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">profiler</span> <span class="o">=</span> <span class="n">NullWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_execution_phase</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">"workflow_definition_fetching"</span><span class="p">,</span>
                    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">"inference_package_operation"</span><span class="p">],</span>
                <span class="p">):</span>
                    <span class="n">workflow_specification</span> <span class="o">=</span> <span class="n">get_workflow_specification</span><span class="p">(</span>
                        <span class="n">api_key</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                        <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_name</span><span class="p">,</span>
                        <span class="n">workflow_id</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span>
                        <span class="n">use_cache</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">use_cache</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">process_workflow_inference_request</span><span class="p">(</span>
                    <span class="n">workflow_request</span><span class="o">=</span><span class="n">workflow_request</span><span class="p">,</span>
                    <span class="n">workflow_specification</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/workflows/run"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to run workflow specification provided in payload"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Parses and executes workflow specification, injecting runtime parameters from request body."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/workflows"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to run workflow specification provided in payload"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Parses and executes workflow specification, injecting runtime parameters from request body. This endpoint is deprecated and will be removed end of Q2 2024."</span><span class="p">,</span>
                <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_from_workflow</span><span class="p">(</span>
                <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowSpecificationInferenceRequest</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="k">if</span> <span class="n">ENABLE_WORKFLOWS_PROFILING</span> <span class="ow">and</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">enable_profiling</span><span class="p">:</span>
                    <span class="n">profiler</span> <span class="o">=</span> <span class="n">BaseWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                        <span class="n">max_runs_in_buffer</span><span class="o">=</span><span class="n">WORKFLOWS_PROFILER_BUFFER_SIZE</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">profiler</span> <span class="o">=</span> <span class="n">NullWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">process_workflow_inference_request</span><span class="p">(</span>
                    <span class="n">workflow_request</span><span class="o">=</span><span class="n">workflow_request</span><span class="p">,</span>
                    <span class="n">workflow_specification</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">specification</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/workflows/execution_engine/versions"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ExecutionEngineVersions</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Returns available Execution Engine versions sorted from oldest to newest"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Returns available Execution Engine versions sorted from oldest to newest"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">get_execution_engine_versions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ExecutionEngineVersions</span><span class="p">:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="n">versions</span> <span class="o">=</span> <span class="n">get_available_versions</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">ExecutionEngineVersions</span><span class="p">(</span><span class="n">versions</span><span class="o">=</span><span class="n">versions</span><span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to get definition of workflows blocks that are accessible"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides detailed information about workflows building blocks that are "</span>
                <span class="s2">"accessible in the inference server. This information could be used to programmatically "</span>
                <span class="s2">"build / display workflows."</span><span class="p">,</span>
                <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflows_blocks</span><span class="p">(</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">handle_describe_workflows_blocks_request</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">gzip_response_if_requested</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to get definition of workflows blocks that are accessible"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides detailed information about workflows building blocks that are "</span>
                <span class="s2">"accessible in the inference server. This information could be used to programmatically "</span>
                <span class="s2">"build / display workflows. Additionally - in request body one can specify list of "</span>
                <span class="s2">"dynamic blocks definitions which will be transformed into blocks and used to generate "</span>
                <span class="s2">"schemas and definitions of connections"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflows_blocks</span><span class="p">(</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">request_payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DescribeBlocksRequest</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="n">dynamic_blocks_definitions</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">requested_execution_engine_version</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">request_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dynamic_blocks_definitions</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">request_payload</span><span class="o">.</span><span class="n">dynamic_blocks_definitions</span>
                    <span class="p">)</span>
                    <span class="n">requested_execution_engine_version</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">request_payload</span><span class="o">.</span><span class="n">execution_engine_version</span>
                    <span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">handle_describe_workflows_blocks_request</span><span class="p">(</span>
                    <span class="n">dynamic_blocks_definitions</span><span class="o">=</span><span class="n">dynamic_blocks_definitions</span><span class="p">,</span>
                    <span class="n">requested_execution_engine_version</span><span class="o">=</span><span class="n">requested_execution_engine_version</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">gzip_response_if_requested</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/workflows/definition/schema"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksSchemaDescription</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to fetch the workflows block schema"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint to fetch the schema of all available blocks. This information can be "</span>
                <span class="s2">"used to validate workflow definitions and suggest syntax in the JSON editor."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">get_workflow_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">WorkflowsBlocksSchemaDescription</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_workflow_schema_description</span><span class="p">()</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/workflows/blocks/dynamic_outputs"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">OutputDefinition</span><span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to get definition of dynamic output for workflow step"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint to be used when step outputs can be discovered only after "</span>
                <span class="s2">"filling manifest with data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">get_dynamic_block_outputs</span><span class="p">(</span>
                <span class="n">step_manifest</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputDefinition</span><span class="p">]:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="c1"># Potentially TODO: dynamic blocks do not support dynamic outputs, but if it changes</span>
                <span class="c1"># we need to provide dynamic blocks manifests here</span>
                <span class="n">dummy_workflow_definition</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0"</span><span class="p">,</span>
                    <span class="s2">"inputs"</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">"steps"</span><span class="p">:</span> <span class="p">[</span><span class="n">step_manifest</span><span class="p">],</span>
                    <span class="s2">"outputs"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
                <span class="n">available_blocks</span> <span class="o">=</span> <span class="n">load_workflow_blocks</span><span class="p">()</span>
                <span class="n">parsed_definition</span> <span class="o">=</span> <span class="n">parse_workflow_definition</span><span class="p">(</span>
                    <span class="n">raw_workflow_definition</span><span class="o">=</span><span class="n">dummy_workflow_definition</span><span class="p">,</span>
                    <span class="n">available_blocks</span><span class="o">=</span><span class="n">available_blocks</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">parsed_manifest</span> <span class="o">=</span> <span class="n">parsed_definition</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">parsed_manifest</span><span class="o">.</span><span class="n">get_actual_outputs</span><span class="p">()</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/workflows/validate"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowValidationStatus</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to validate"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides a way to check validity of JSON workflow definition."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">validate_workflow</span><span class="p">(</span>
                <span class="n">specification</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowValidationStatus</span><span class="p">:</span>
                <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
                <span class="n">step_execution_mode</span> <span class="o">=</span> <span class="n">StepExecutionMode</span><span class="p">(</span><span class="n">WORKFLOWS_STEP_EXECUTION_MODE</span><span class="p">)</span>
                <span class="n">workflow_init_parameters</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"workflows_core.model_manager"</span><span class="p">:</span> <span class="n">model_manager</span><span class="p">,</span>
                    <span class="s2">"workflows_core.api_key"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">"workflows_core.background_tasks"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">"workflows_core.step_execution_mode"</span><span class="p">:</span> <span class="n">step_execution_mode</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">ExecutionEngine</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                    <span class="n">workflow_definition</span><span class="o">=</span><span class="n">specification</span><span class="p">,</span>
                    <span class="n">init_parameters</span><span class="o">=</span><span class="n">workflow_init_parameters</span><span class="p">,</span>
                    <span class="n">max_concurrent_steps</span><span class="o">=</span><span class="n">WORKFLOWS_MAX_CONCURRENT_STEPS</span><span class="p">,</span>
                    <span class="n">prevent_local_images_loading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">WorkflowValidationStatus</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">"ok"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ENABLE_STREAM_API</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/list"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ListPipelinesResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] List active InferencePipelines"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Listing all active InferencePipelines processing videos"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">list_pipelines</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ListPipelinesResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">list_pipelines</span><span class="p">()</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/status"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">InferencePipelineStatusResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Get status of InferencePipeline"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Get status of InferencePipeline"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferencePipelineStatusResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span>
                    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/initialise"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Starts new InferencePipeline"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Starts new InferencePipeline"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">InitialisePipelinePayload</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">initialise_pipeline</span><span class="p">(</span>
                    <span class="n">initialisation_request</span><span class="o">=</span><span class="n">request</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/initialise_webrtc"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">InitializeWebRTCPipelineResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Establishes WebRTC peer connection and starts new InferencePipeline consuming video track"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Establishes WebRTC peer connection and starts new InferencePipeline consuming video track"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">initialise_webrtc_inference_pipeline</span><span class="p">(</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">InitialiseWebRTCPipelinePayload</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">initialise_webrtc_pipeline</span><span class="p">(</span>
                    <span class="n">initialisation_request</span><span class="o">=</span><span class="n">request</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">resp</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/pause"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Pauses the InferencePipeline"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Pauses the InferencePipeline"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">pause_pipeline</span><span class="p">(</span>
                    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/resume"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Resumes the InferencePipeline"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Resumes the InferencePipeline"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">resume_pipeline</span><span class="p">(</span>
                    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/terminate"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Terminates the InferencePipeline"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Terminates the InferencePipeline"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">terminate_pipeline</span><span class="p">(</span>
                    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
                <span class="p">)</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/consume"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ConsumePipelineResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Consumes InferencePipeline result"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Consumes InferencePipeline result"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConsumeResultsPayload</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConsumePipelineResponse</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">request</span> <span class="o">=</span> <span class="n">ConsumeResultsPayload</span><span class="p">()</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">consume_pipeline_result</span><span class="p">(</span>
                    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">,</span>
                    <span class="n">excluded_fields</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">excluded_fields</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">CORE_MODELS_ENABLED</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CORE_MODEL_CLIP_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/embed_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Image Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipImageEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (ClipImageEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        ClipEmbeddingResponse: The response containing the embedded image.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/embed_image"</span><span class="p">)</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/embed_text"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Text Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed text data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_text</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipTextEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds text data using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (ClipTextEmbeddingRequest): The request containing the text to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        ClipEmbeddingResponse: The response containing the embedded text.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/embed_text"</span><span class="p">)</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/clip/compare"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ClipCompareResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Compare"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to compute similarity scores."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_compare</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipCompareRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Computes similarity scores using the OpenAI CLIP model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (ClipCompareRequest): The request containing the data to be compared.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        ClipCompareResponse: The response containing the similarity scores.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/compare"</span><span class="p">)</span>
                    <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_GROUNDINGDINO_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/grounding_dino/infer"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"Grounding DINO inference."</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Grounding DINO zero-shot object detection model."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">grounding_dino_infer</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">GroundingDINOInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the Grounding DINO model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request GroundingDINOInferenceRequest): The request containing the image on which to run object detection.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        ObjectDetectionInferenceResponse: The object detection response.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /grounding_dino/infer"</span><span class="p">)</span>
                    <span class="n">grounding_dino_model_id</span> <span class="o">=</span> <span class="n">load_grounding_dino_model</span><span class="p">(</span>
                        <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">grounding_dino_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">grounding_dino_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_YOLO_WORLD_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/yolo_world/infer"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"YOLO-World inference."</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the YOLO-World zero-shot object detection model."</span><span class="p">,</span>
                    <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">yolo_world_infer</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">YOLOWorldInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Runs the YOLO-World zero-shot object detection model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (YOLOWorldInferenceRequest): The request containing the image on which to run object detection.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        ObjectDetectionInferenceResponse: The object detection response.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /yolo_world/infer. Loading model"</span><span class="p">)</span>
                    <span class="n">yolo_world_model_id</span> <span class="o">=</span> <span class="n">load_yolo_world_model</span><span class="p">(</span>
                        <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"YOLOWorld model loaded. Staring the inference."</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">yolo_world_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"YOLOWorld prediction available."</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">yolo_world_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Usage of YOLOWorld denoted."</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_DOCTR_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/doctr/ocr"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">OCRInferenceResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"DocTR OCR response"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the DocTR OCR model to retrieve text in an image."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">doctr_retrieve_text</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">DoctrOCRInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the DocTR model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.DoctrOCRInferenceRequest): The request containing the image from which to retrieve text.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.OCRInferenceResponse: The response containing the embedded image.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /doctr/ocr"</span><span class="p">)</span>
                    <span class="n">doctr_model_id</span> <span class="o">=</span> <span class="n">load_doctr_model</span><span class="p">(</span>
                        <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">doctr_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">doctr_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_SAM_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam/embed_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">SamEmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to embed image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_embed_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">SamEmbeddingRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.SamEmbeddingResponse or Response: The response containing the embedded image.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam/embed_image"</span><span class="p">)</span>
                    <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam/segment_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">SamSegmentationResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Segmentation"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to generate segmenations for image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_segment_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">SamSegmentationRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Generates segmentations for image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (SamSegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam/segment_image"</span><span class="p">)</span>
                    <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_SAM2_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam2/embed_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">Sam2EmbeddingResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM2 Image Embeddings"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segment Anything 2 Model to embed image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam2_embed_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">Sam2EmbeddingRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the Meta AI Segment Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.Sam2EmbeddingResponse or Response: The response affirming the image has been embedded</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam2/embed_image"</span><span class="p">)</span>
                    <span class="n">sam2_model_id</span> <span class="o">=</span> <span class="n">load_sam2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">sam2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/sam2/segment_image"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">Sam2SegmentationResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM2 Image Segmentation"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segment Anything 2 Model to generate segmenations for image data."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">sam2_segment_image</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">Sam2SegmentationRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Generates segmentations for image data using the Meta AI Segment Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (Sam2SegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam2/segment_image"</span><span class="p">)</span>
                    <span class="n">sam2_model_id</span> <span class="o">=</span> <span class="n">load_sam2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">sam2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_OWLV2_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/owlv2/infer"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"Owlv2 image prompting"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the google owlv2 model to few-shot object detect"</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">owlv2_infer</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">OwlV2InferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.Sam2EmbeddingResponse or Response: The response affirming the image has been embedded</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /owlv2/infer"</span><span class="p">)</span>
                    <span class="n">owl2_model_id</span> <span class="o">=</span> <span class="n">load_owlv2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">owl2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">model_response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_GAZE_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/gaze/gaze_detection"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">GazeDetectionInferenceResponse</span><span class="p">],</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"Gaze Detection"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the gaze detection model to detect gaze."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">gaze_detection</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">GazeDetectionInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Detect gaze using the gaze detection model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.GazeDetectionRequest): The request containing the image to be detected.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.GazeDetectionResponse: The response containing all the detected faces and the corresponding gazes.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /gaze/gaze_detection"</span><span class="p">)</span>
                    <span class="n">gaze_model_id</span> <span class="o">=</span> <span class="n">load_gaze_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">gaze_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">gaze_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_COGVLM_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/llm/cogvlm"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">CogVLMResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"CogVLM"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the CogVLM model to chat or describe an image."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">cog_vlm</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">CogVLMInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Chat with CogVLM or ask it about an image. Multi-image requests not currently supported.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (M.CogVLMInferenceRequest): The request containing the prompt and image to be described.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        M.CogVLMResponse: The model's text response</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /llm/cogvlm"</span><span class="p">)</span>
                    <span class="n">cog_model_id</span> <span class="o">=</span> <span class="n">load_cogvlm_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">cog_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">cog_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">CORE_MODEL_TROCR_ENABLED</span><span class="p">:</span>

                <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s2">"/ocr/trocr"</span><span class="p">,</span>
                    <span class="n">response_model</span><span class="o">=</span><span class="n">OCRInferenceResponse</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">"TrOCR OCR response"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Run the TrOCR model to retrieve text in an image."</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nd">@with_route_exceptions</span>
                <span class="k">async</span> <span class="k">def</span> <span class="nf">trocr_retrieve_text</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">:</span> <span class="n">TrOCRInferenceRequest</span><span class="p">,</span>
                    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                    <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
<span class="w">                    </span><span class="sd">"""</span>
<span class="sd">                    Retrieves text from image data using the TrOCR model.</span>

<span class="sd">                    Args:</span>
<span class="sd">                        inference_request (TrOCRInferenceRequest): The request containing the image from which to retrieve text.</span>
<span class="sd">                        api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                        request (Request, default Body()): The HTTP request.</span>

<span class="sd">                    Returns:</span>
<span class="sd">                        OCRInferenceResponse: The response containing the retrieved text.</span>
<span class="sd">                    """</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /trocr/ocr"</span><span class="p">)</span>
                    <span class="n">trocr_model_id</span> <span class="o">=</span> <span class="n">load_trocr_model</span><span class="p">(</span>
                        <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                    <span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                        <span class="n">trocr_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                        <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                            <span class="s2">"authorizer"</span>
                        <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">trocr_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/notebook/start"</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Jupyter Lab Server Start"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Starts a jupyter lab server for running development code"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">notebook_start</span><span class="p">(</span><span class="n">browserless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""Starts a jupyter lab server for running development code.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (NotebookStartRequest): The request containing the necessary details for starting a jupyter lab server.</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                Returns:</span>
<span class="sd">                    NotebookStartResponse: The response containing the URL of the jupyter lab server.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /notebook/start"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">NOTEBOOK_ENABLED</span><span class="p">:</span>
                    <span class="n">start_notebook</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">browserless</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">{</span>
                            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s2">"message"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Jupyter Lab server started at http://localhost:</span><span class="si">{</span><span class="n">NOTEBOOK_PORT</span><span class="si">}</span><span class="s2">?token=</span><span class="si">{</span><span class="n">NOTEBOOK_PASSWORD</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"http://localhost:</span><span class="si">{</span><span class="n">NOTEBOOK_PORT</span><span class="si">}</span><span class="s2">/lab/tree/quickstart.ipynb?token=</span><span class="si">{</span><span class="n">NOTEBOOK_PASSWORD</span><span class="si">}</span><span class="s2">"</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">browserless</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">{</span>
                            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Notebook server is not enabled. Enable notebooks via the NOTEBOOK_ENABLED environment variable."</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">"/notebook-instructions.html"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LEGACY_ROUTE_ENABLED</span><span class="p">:</span>

            <span class="k">class</span> <span class="nc">IntStringConvertor</span><span class="p">(</span><span class="n">StringConvertor</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Match digits but keep them as string.</span>
<span class="sd">                """</span>

                <span class="n">regex</span> <span class="o">=</span> <span class="s2">"\d+"</span>

            <span class="n">register_url_convertor</span><span class="p">(</span><span class="s2">"int_string"</span><span class="p">,</span> <span class="n">IntStringConvertor</span><span class="p">())</span>

            <span class="c1"># Legacy object detection inference path for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/{version_id:int_string}"</span><span class="p">,</span>
                <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                    <span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">StubResponse</span><span class="p">,</span>
                    <span class="n">Any</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/{version_id:int_string}"</span><span class="p">,</span>
                <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                    <span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                    <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                    <span class="n">StubResponse</span><span class="p">,</span>
                    <span class="n">Any</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_infer_from_request</span><span class="p">(</span>
                <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset corresponding to the model to use for inference"</span>
                <span class="p">),</span>
                <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset version corresponding to the model to use for inference"</span>
                <span class="p">),</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out predictions"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">keypoint_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out keypoints that are not visible based on model confidence"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"json"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'json' or 'image'. If 'json' prediction data is return as a JSON string. If 'image' prediction data is visualized and overlayed on the original input image."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The publically accessible URL of an image to use for inference."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">image_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"base64"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of base64 or numpy. Note, numpy input is not supported for Roboflow Hosted Inference."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If true, labels will be include in any inference visualization."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">mask_decode_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"accurate"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'accurate' or 'fast'. If 'accurate' the mask will be decoded using the original image size. If 'fast' the mask will be decoded using the original mask size. 'accurate' is slower but more accurate."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">tradeoff_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The amount to tradeoff between 0='fast' and 1='accurate'"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">max_detections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mi">300</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The maximum number of detections to return. This is used to limit the number of predictions returned by the model. The model may return more predictions than this number, but only the top `max_detections` predictions will be returned."</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mf">0.3</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The IoU threhsold that must be met for a box pair to be considered duplicate during NMS"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">stroke</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"The stroke width used when visualizing predictions"</span>
                <span class="p">),</span>
                <span class="n">countinference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If false, does not track inference against usage."</span><span class="p">,</span>
                    <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">service_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Shared secret used to authenticate requests to the inference server from internal services (e.g. to allow disabling inference usage tracking via the `countinference` query parameter)"</span><span class="p">,</span>
                    <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">disable_preproc_auto_orient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic image orientation"</span>
                <span class="p">),</span>
                <span class="n">disable_preproc_contrast</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic contrast adjustment"</span>
                <span class="p">),</span>
                <span class="n">disable_preproc_grayscale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic grayscale conversion"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">disable_preproc_static_crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic static crop"</span>
                <span class="p">),</span>
                <span class="n">disable_active_learning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"If true, the predictions will be prevented from registration by Active Learning (if the functionality is enabled)"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">active_learning_target_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Parameter to be used when Active Learning data registration should happen against different dataset than the one pointed by model_id"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"external"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The source of the inference request"</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">source_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="s2">"external"</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"The detailed source information of the inference request"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Legacy inference endpoint for object detection, instance segmentation, and classification.</span>

<span class="sd">                Args:</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>
<span class="sd">                    dataset_id (str): ID of a Roboflow dataset corresponding to the model to use for inference.</span>
<span class="sd">                    version_id (str): ID of a Roboflow dataset version corresponding to the model to use for inference.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    # Other parameters described in the function signature...</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[InstanceSegmentationInferenceResponse, KeypointsDetectionInferenceRequest, ObjectDetectionInferenceResponse, ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse, Any]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Reached legacy route /:dataset_id/:version_id with </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>

                <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">confidence</span> <span class="o">/=</span> <span class="mi">100</span>
                <span class="k">elif</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                    <span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.01</span>

                <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">overlap</span> <span class="o">/=</span> <span class="mi">100</span>

                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"url"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">"Content-Type"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ContentTypeMissing</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"Request must include a Content-Type header"</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="s2">"multipart/form-data"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]:</span>
                        <span class="n">form_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
                        <span class="n">base64_image_str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">form_data</span><span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                        <span class="n">base64_image_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">base64_image_str</span><span class="p">)</span>
                        <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span>
                            <span class="nb">type</span><span class="o">=</span><span class="s2">"base64"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">base64_image_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"ascii"</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="s2">"application/x-www-form-urlencoded"</span>
                        <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                        <span class="ow">or</span> <span class="s2">"application/json"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
                        <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ContentTypeInvalid</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"Invalid Content-Type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">countinference</span> <span class="ow">and</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                        <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">request_model_id</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                            <span class="s2">"lambda"</span>
                        <span class="p">][</span><span class="s2">"model"</span><span class="p">][</span><span class="s2">"endpoint"</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"--"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"rf-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"nu-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                        <span class="s2">"lambda"</span>
                    <span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">countinference</span><span class="p">:</span>
                        <span class="n">trackUsage</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                                <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">request_model_id</span> <span class="o">=</span> <span class="n">model_id</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"State of model registry: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span>
                    <span class="n">request_model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">model_id_alias</span><span class="o">=</span><span class="n">model_id</span>
                <span class="p">)</span>

                <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">get_task_type</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">ObjectDetectionInferenceRequest</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"instance-segmentation"</span><span class="p">:</span>
                    <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">InstanceSegmentationInferenceRequest</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">"mask_decode_mode"</span><span class="p">:</span> <span class="n">mask_decode_mode</span><span class="p">,</span>
                        <span class="s2">"tradeoff_factor"</span><span class="p">:</span> <span class="n">tradeoff_factor</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"classification"</span><span class="p">:</span>
                    <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">ClassificationInferenceRequest</span>
                <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"keypoint-detection"</span><span class="p">:</span>
                    <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">KeypointsDetectionInferenceRequest</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"keypoint_confidence"</span><span class="p">:</span> <span class="n">keypoint_confidence</span><span class="p">}</span>
                <span class="n">inference_request</span> <span class="o">=</span> <span class="n">inference_request_type</span><span class="p">(</span>
                    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
                    <span class="n">image</span><span class="o">=</span><span class="n">request_image</span><span class="p">,</span>
                    <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                    <span class="n">iou_threshold</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                    <span class="n">max_detections</span><span class="o">=</span><span class="n">max_detections</span><span class="p">,</span>
                    <span class="n">visualization_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">visualization_stroke_width</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                    <span class="n">visualize_predictions</span><span class="o">=</span><span class="p">(</span>
                        <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image_and_json"</span>
                    <span class="p">),</span>
                    <span class="n">disable_preproc_auto_orient</span><span class="o">=</span><span class="n">disable_preproc_auto_orient</span><span class="p">,</span>
                    <span class="n">disable_preproc_contrast</span><span class="o">=</span><span class="n">disable_preproc_contrast</span><span class="p">,</span>
                    <span class="n">disable_preproc_grayscale</span><span class="o">=</span><span class="n">disable_preproc_grayscale</span><span class="p">,</span>
                    <span class="n">disable_preproc_static_crop</span><span class="o">=</span><span class="n">disable_preproc_static_crop</span><span class="p">,</span>
                    <span class="n">disable_active_learning</span><span class="o">=</span><span class="n">disable_active_learning</span><span class="p">,</span>
                    <span class="n">active_learning_target_dataset</span><span class="o">=</span><span class="n">active_learning_target_dataset</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                    <span class="n">source_info</span><span class="o">=</span><span class="n">source_info</span><span class="p">,</span>
                    <span class="n">usage_billable</span><span class="o">=</span><span class="n">countinference</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">args</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">inference_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
                    <span class="n">inference_request</span><span class="p">,</span>
                    <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Response ready."</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">inference_response</span><span class="o">.</span><span class="n">visualization</span><span class="p">,</span>
                        <span class="n">media_type</span><span class="o">=</span><span class="s2">"image/jpeg"</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">inference_response</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>
            <span class="c1"># Legacy clear cache endpoint for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/clear_cache"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_clear_cache</span><span class="p">():</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Clears the model cache.</span>

<span class="sd">                This endpoint provides a way to clear the cache of loaded models.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    str: A string indicating that the cache has been cleared.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clear_cache"</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">model_clear</span><span class="p">()</span>
                <span class="k">return</span> <span class="s2">"Cache Cleared"</span>

            <span class="c1"># Legacy add model endpoint for backwards compatability</span>
            <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/start/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Starts a model inference session.</span>

<span class="sd">                This endpoint initializes and starts an inference session for the specified model version.</span>

<span class="sd">                Args:</span>
<span class="sd">                    dataset_id (str): ID of a Roboflow dataset corresponding to the model.</span>
<span class="sd">                    version_id (str): ID of a Roboflow dataset version corresponding to the model.</span>
<span class="sd">                    api_key (str, optional): Roboflow API Key for artifact retrieval.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    JSONResponse: A response object containing the status and a success message.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Reached /start/</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
                <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">"status"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                        <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"inference session started from local memory."</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span>
            <span class="s2">"/"</span><span class="p">,</span>
            <span class="n">StaticFiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s2">"./inference/landing/out"</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">"static"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.http.http_api.HttpInterface.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_manager</span><span class="p">,</span> <span class="n">root_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.http.http_api.HttpInterface.__init__" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Initializes the HttpInterface with given model manager and model registry.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>model_manager</code>
</td>
<td>
<code><a class="autorefs autorefs-internal" title="inference.core.managers.base.ModelManager" href="../../../managers/base/#inference.core.managers.base.ModelManager">ModelManager</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The manager for handling different models.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>root_path</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[str]</code>
</td>
<td>
<div class="doc-md-description">
<p>The root path for the FastAPI application.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="description" open="">
<summary>Description</summary>
<p>Deploy Roboflow trained models to nearly any compute environment!</p>
</details>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/http/http_api.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_manager</span><span class="p">:</span> <span class="n">ModelManager</span><span class="p">,</span>
    <span class="n">root_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initializes the HttpInterface with given model manager and model registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_manager (ModelManager): The manager for handling different models.</span>
<span class="sd">        root_path (Optional[str]): The root path for the FastAPI application.</span>

<span class="sd">    Description:</span>
<span class="sd">        Deploy Roboflow trained models to nearly any compute environment!</span>
<span class="sd">    """</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">"Roboflow inference server"</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
        <span class="n">terms_of_service</span><span class="o">=</span><span class="s2">"https://roboflow.com/terms"</span><span class="p">,</span>
        <span class="n">contact</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Roboflow Inc."</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://roboflow.com/contact"</span><span class="p">,</span>
            <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"help@roboflow.com"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">license_info</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Apache 2.0"</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://www.apache.org/licenses/LICENSE-2.0.html"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">root_path</span><span class="o">=</span><span class="n">root_path</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">ENABLE_PROMETHEUS</span><span class="p">:</span>
        <span class="n">InferenceInstrumentator</span><span class="p">(</span>
            <span class="n">app</span><span class="p">,</span> <span class="n">model_manager</span><span class="o">=</span><span class="n">model_manager</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s2">"/metrics"</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">METLO_KEY</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">ASGIMiddleware</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"https://app.metlo.com"</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">METLO_KEY</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span><span class="n">LambdaMiddleware</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ALLOW_ORIGINS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">CORSMiddleware</span><span class="p">,</span>
            <span class="n">allow_origins</span><span class="o">=</span><span class="n">ALLOW_ORIGINS</span><span class="p">,</span>
            <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
            <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Optionally add middleware for profiling the FastAPI server and underlying inference API code</span>
    <span class="k">if</span> <span class="n">PROFILE</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
            <span class="n">CProfileMiddleware</span><span class="p">,</span>
            <span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">server_app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="s2">"/profile/output.pstats"</span><span class="p">,</span>
            <span class="n">strip_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sort_by</span><span class="o">=</span><span class="s2">"cumulative"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span><span class="n">asgi_correlation_id</span><span class="o">.</span><span class="n">CorrelationIdMiddleware</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">METRICS_ENABLED</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">count_errors</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Middleware to count errors.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (Request): The incoming request.</span>
<span class="sd">                call_next (Callable): The next middleware or endpoint to call.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Response: The response from the next middleware or endpoint.</span>
<span class="sd">            """</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">pingback</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">num_errors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">response</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/device/stats"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">device_stats</span><span class="p">():</span>
            <span class="n">not_configured_error_message</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Device statistics endpoint is not enabled."</span><span class="p">,</span>
                <span class="s2">"hint"</span><span class="p">:</span> <span class="s2">"Mount the Docker socket and point its location when running the docker "</span>
                <span class="s2">"container to collect device stats "</span>
                <span class="s2">"(i.e. `docker run ... -v /var/run/docker.sock:/var/run/docker.sock "</span>
                <span class="s2">"-e DOCKER_SOCKET_PATH=/var/run/docker.sock ...`)."</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">DOCKER_SOCKET_PATH</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">not_configured_error_message</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_docker_socket_mounted</span><span class="p">(</span><span class="n">docker_socket_path</span><span class="o">=</span><span class="n">DOCKER_SOCKET_PATH</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">not_configured_error_message</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">container_stats</span> <span class="o">=</span> <span class="n">get_container_stats</span><span class="p">(</span>
                <span class="n">docker_socket_path</span><span class="o">=</span><span class="n">DOCKER_SOCKET_PATH</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">container_stats</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">:</span>
        <span class="n">cached_api_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">cached_projects</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">check_authorization</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
            <span class="c1"># exclusions</span>
            <span class="n">skip_check</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">]</span>
                <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span>
                <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">"/"</span><span class="p">,</span>
                    <span class="s2">"/info"</span><span class="p">,</span>
                    <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
                    <span class="s2">"/workflows/definition/schema"</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"/static/"</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"/_next/"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">skip_check</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">_unauthorized_response</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span>
                    <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">"status"</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
                        <span class="s2">"message"</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># check api_key</span>
            <span class="n">req_params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span>
            <span class="n">json_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content-type"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"application/json"</span>
                <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content-length"</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">json_params</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">req_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"api_key"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"api_key"</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">cached_api_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">workspace_url</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">get_roboflow_workspace</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">workspace_url</span> <span class="o">!=</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized api_key"</span><span class="p">)</span>

                    <span class="n">cached_api_keys</span><span class="p">[</span><span class="n">api_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span>
                    <span class="p">)</span>  <span class="c1"># expired after 1 hour</span>
                <span class="k">except</span> <span class="n">RoboflowAPINotAuthorizedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized api_key"</span><span class="p">)</span>

            <span class="c1"># check project_url</span>
            <span class="n">model_id</span> <span class="o">=</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">project_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">req_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"project"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"project"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">model_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># only check when project_url is not None</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">project_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">cached_projects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project_url</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_</span> <span class="o">=</span> <span class="n">get_roboflow_dataset_type</span><span class="p">(</span>
                        <span class="n">api_key</span><span class="p">,</span> <span class="n">DEDICATED_DEPLOYMENT_WORKSPACE_URL</span><span class="p">,</span> <span class="n">project_url</span>
                    <span class="p">)</span>

                    <span class="n">cached_projects</span><span class="p">[</span><span class="n">project_url</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span>
                    <span class="p">)</span>  <span class="c1"># expired after 1 hour</span>
                <span class="k">except</span> <span class="n">RoboflowAPINotNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_unauthorized_response</span><span class="p">(</span><span class="s2">"Unauthorized project"</span><span class="p">)</span>

            <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">model_manager</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StreamManagerClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">ENABLE_STREAM_API</span><span class="p">:</span>
        <span class="n">operations_timeout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_OPERATIONS_TIMEOUT"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operations_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">operations_timeout</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">operations_timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span> <span class="o">=</span> <span class="n">StreamManagerClient</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_HOST"</span><span class="p">,</span> <span class="s2">"127.0.0.1"</span><span class="p">),</span>
            <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STREAM_MANAGER_PORT"</span><span class="p">,</span> <span class="s2">"7070"</span><span class="p">)),</span>
            <span class="n">operations_timeout</span><span class="o">=</span><span class="n">operations_timeout</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_inference_request</span><span class="p">(</span>
        <span class="n">inference_request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Processes an inference request by calling the appropriate model.</span>

<span class="sd">        Args:</span>
<span class="sd">            inference_request (InferenceRequest): The request containing model ID and other inference details.</span>

<span class="sd">        Returns:</span>
<span class="sd">            InferenceResponse: The response containing the inference results.</span>
<span class="sd">        """</span>
        <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
            <span class="n">model_id</span><span class="o">=</span><span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
            <span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_workflow_inference_request</span><span class="p">(</span>
        <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowInferenceRequest</span><span class="p">,</span>
        <span class="n">workflow_specification</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">background_tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BackgroundTasks</span><span class="p">],</span>
        <span class="n">profiler</span><span class="p">:</span> <span class="n">WorkflowsProfiler</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
        <span class="n">workflow_init_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"workflows_core.model_manager"</span><span class="p">:</span> <span class="n">model_manager</span><span class="p">,</span>
            <span class="s2">"workflows_core.api_key"</span><span class="p">:</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="s2">"workflows_core.background_tasks"</span><span class="p">:</span> <span class="n">background_tasks</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">execution_engine</span> <span class="o">=</span> <span class="n">ExecutionEngine</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
            <span class="n">workflow_definition</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
            <span class="n">init_parameters</span><span class="o">=</span><span class="n">workflow_init_parameters</span><span class="p">,</span>
            <span class="n">max_concurrent_steps</span><span class="o">=</span><span class="n">WORKFLOWS_MAX_CONCURRENT_STEPS</span><span class="p">,</span>
            <span class="n">prevent_local_images_loading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">execution_engine</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime_parameters</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_execution_phase</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">"workflow_results_serialisation"</span><span class="p">,</span>
            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">"inference_package_operation"</span><span class="p">],</span>
        <span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">serialise_workflow_result</span><span class="p">(</span>
                <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                <span class="n">excluded_fields</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">excluded_fields</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">profiler_trace</span> <span class="o">=</span> <span class="n">profiler</span><span class="o">.</span><span class="n">export_trace</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">WorkflowInferenceResponse</span><span class="p">(</span>
            <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span>
            <span class="n">profiler_trace</span><span class="o">=</span><span class="n">profiler_trace</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_core_model</span><span class="p">(</span>
        <span class="n">inference_request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">core_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Loads a core model (e.g., "clip" or "sam") into the model manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            inference_request (InferenceRequest): The request containing version and other details.</span>
<span class="sd">            api_key (Optional[str]): The API key for the request.</span>
<span class="sd">            core_model (str): The core model type, e.g., "clip" or "sam".</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The core model ID.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="n">version_id_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">_version_id"</span>
        <span class="n">core_model_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">core_model</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">inference_request</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">version_id_field</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">core_model_id</span><span class="p">,</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">core_model_id</span>

    <span class="n">load_clip_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"clip"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the CLIP model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The CLIP model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_sam_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the SAM model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The SAM model ID.</span>
<span class="sd">    """</span>
    <span class="n">load_sam2_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"sam2"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the SAM2 model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The SAM2 model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_gaze_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"gaze"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the GAZE model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The GAZE model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_doctr_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"doctr"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the DocTR model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The DocTR model ID.</span>
<span class="sd">    """</span>
    <span class="n">load_cogvlm_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"cogvlm"</span><span class="p">)</span>
    <span class="n">load_paligemma_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"paligemma"</span><span class="p">)</span>

    <span class="n">load_grounding_dino_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"grounding_dino"</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the Grounding DINO model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The Grounding DINO model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_yolo_world_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"yolo_world"</span><span class="p">)</span>
    <span class="n">load_owlv2_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"owlv2"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the YOLO World model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The YOLO World model ID.</span>
<span class="sd">    """</span>

    <span class="n">load_trocr_model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">load_core_model</span><span class="p">,</span> <span class="n">core_model</span><span class="o">=</span><span class="s2">"trocr"</span><span class="p">)</span>
<span class="w">    </span><span class="sd">"""Loads the TrOCR model into the model manager.</span>

<span class="sd">    Args:</span>
<span class="sd">    inference_request: The request containing version and other details.</span>
<span class="sd">    api_key: The API key for the request.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The TrOCR model ID.</span>
<span class="sd">    """</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">"/info"</span><span class="p">,</span>
        <span class="n">response_model</span><span class="o">=</span><span class="n">ServerVersionInfo</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="s2">"Info"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"Get the server name and version number"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
<span class="w">        </span><span class="sd">"""Endpoint to get the server name and version number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ServerVersionInfo: The server version information.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">ServerVersionInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">"Roboflow Inference Server"</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">uuid</span><span class="o">=</span><span class="n">GLOBAL_INFERENCE_SERVER_ID</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># The current AWS Lambda authorizer only supports path parameters, therefore we can only use the legacy infer route. This case statement excludes routes which won't work for the current Lambda authorizer.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/model/registry"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Get model keys"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Get the ID of each loaded model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">registry</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Get the ID of each loaded model in the registry.</span>

<span class="sd">            Returns:</span>
<span class="sd">                ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/registry"</span><span class="p">)</span>
            <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/add"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Load a model"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Load the model with the given model ID"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">AddModelRequest</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Load the model with the given model ID into the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (AddModelRequest): The request containing the model ID and optional API key.</span>

<span class="sd">            Returns:</span>
<span class="sd">                ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/add"</span><span class="p">)</span>
            <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/remove"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove a model"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Remove the model with the given model ID"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_remove</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ClearModelRequest</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Remove the model with the given model ID from the model manager.</span>

<span class="sd">            Args:</span>
<span class="sd">                request (ClearModelRequest): The request containing the model ID to be removed.</span>

<span class="sd">            Returns:</span>
<span class="sd">                ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/remove"</span><span class="p">)</span>
            <span class="n">de_aliased_model_id</span> <span class="o">=</span> <span class="n">resolve_roboflow_model_alias</span><span class="p">(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_id</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">de_aliased_model_id</span><span class="p">)</span>
            <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/model/clear"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ModelsDescriptions</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Remove all models"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Remove all loaded models"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_clear</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""Remove all loaded models from the model manager.</span>

<span class="sd">            Returns:</span>
<span class="sd">                ModelsDescriptions: The object containing models descriptions</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /model/clear"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">models_descriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ModelsDescriptions</span><span class="o">.</span><span class="n">from_models_descriptions</span><span class="p">(</span>
                <span class="n">models_descriptions</span><span class="o">=</span><span class="n">models_descriptions</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/object_detection"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">List</span><span class="p">[</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">],</span>
                <span class="n">StubResponse</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Object detection infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified object detection model"</span><span class="p">,</span>
            <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_object_detection</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">ObjectDetectionInferenceRequest</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>
<span class="sd">                background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[ObjectDetectionInferenceResponse, List[ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/object_detection"</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">,</span>
                <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/instance_segmentation"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span> <span class="n">StubResponse</span>
            <span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Instance segmentation infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified instance segmentation model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_instance_segmentation</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">InstanceSegmentationInferenceRequest</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified instance segmentation model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (InstanceSegmentationInferenceRequest): The request containing the necessary details for instance segmentation.</span>
<span class="sd">                background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">            Returns:</span>
<span class="sd">                InstanceSegmentationInferenceResponse: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/instance_segmentation"</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">,</span>
                <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/classification"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">StubResponse</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Classification infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified classification model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_classification</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClassificationInferenceRequest</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified classification model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (ClassificationInferenceRequest): The request containing the necessary details for classification.</span>
<span class="sd">                background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/classification"</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">,</span>
                <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/keypoints_detection"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span><span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span> <span class="n">StubResponse</span><span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Keypoints detection infer"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified keypoints detection model"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_keypoints</span><span class="p">(</span>
            <span class="n">inference_request</span><span class="p">:</span> <span class="n">KeypointsDetectionInferenceRequest</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""Run inference with the specified keypoints detection model.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (KeypointsDetectionInferenceRequest): The request containing the necessary details for keypoints detection.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse]: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/keypoints_detection"</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LMM_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/infer/lmm"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                    <span class="n">LMMInferenceResponse</span><span class="p">,</span>
                    <span class="n">List</span><span class="p">[</span><span class="n">LMMInferenceResponse</span><span class="p">],</span>
                    <span class="n">StubResponse</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Large multi-modal model infer"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run inference with the specified large multi-modal model"</span><span class="p">,</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_lmm</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">LMMInferenceRequest</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""Run inference with the specified object detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ObjectDetectionInferenceRequest): The request containing the necessary details for object detection.</span>
<span class="sd">                    background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[ObjectDetectionInferenceResponse, List[ObjectDetectionInferenceResponse]]: The response containing the inference results.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /infer/lmm"</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">process_inference_request</span><span class="p">(</span><span class="n">inference_request</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">DISABLE_WORKFLOW_ENDPOINTS</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/</span><span class="si">{workspace_name}</span><span class="s2">/workflows/</span><span class="si">{workflow_id}</span><span class="s2">/describe_interface"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">DescribeInterfaceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to describe interface of predefined workflow"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - describes workflow inputs and outputs"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_predefined_workflow_interface</span><span class="p">(</span>
            <span class="n">workspace_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">workflow_request</span><span class="p">:</span> <span class="n">PredefinedWorkflowDescribeInterfaceRequest</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DescribeInterfaceResponse</span><span class="p">:</span>
            <span class="n">workflow_specification</span> <span class="o">=</span> <span class="n">get_workflow_specification</span><span class="p">(</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_name</span><span class="p">,</span>
                <span class="n">workflow_id</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span>
                <span class="n">use_cache</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">use_cache</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_describe_workflows_interface</span><span class="p">(</span>
                <span class="n">definition</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/workflows/describe_interface"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">DescribeInterfaceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to describe interface of workflow given in request"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Parses workflow definition and retrieves describes inputs and outputs"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflow_interface</span><span class="p">(</span>
            <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowSpecificationDescribeInterfaceRequest</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DescribeInterfaceResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle_describe_workflows_interface</span><span class="p">(</span>
                <span class="n">definition</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">specification</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/</span><span class="si">{workspace_name}</span><span class="s2">/workflows/</span><span class="si">{workflow_id}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to run predefined workflow"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - parses and executes injecting runtime parameters from request body"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/workflows/</span><span class="si">{workspace_name}</span><span class="s2">/</span><span class="si">{workflow_id}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to run predefined workflow"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Checks Roboflow API for workflow definition, once acquired - parses and executes injecting runtime parameters from request body. This endpoint is deprecated and will be removed end of Q2 2024"</span><span class="p">,</span>
            <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_from_predefined_workflow</span><span class="p">(</span>
            <span class="n">workspace_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">workflow_request</span><span class="p">:</span> <span class="n">PredefinedWorkflowInferenceRequest</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="k">if</span> <span class="n">ENABLE_WORKFLOWS_PROFILING</span> <span class="ow">and</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">enable_profiling</span><span class="p">:</span>
                <span class="n">profiler</span> <span class="o">=</span> <span class="n">BaseWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                    <span class="n">max_runs_in_buffer</span><span class="o">=</span><span class="n">WORKFLOWS_PROFILER_BUFFER_SIZE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">profiler</span> <span class="o">=</span> <span class="n">NullWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_execution_phase</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">"workflow_definition_fetching"</span><span class="p">,</span>
                <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">"inference_package_operation"</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="n">workflow_specification</span> <span class="o">=</span> <span class="n">get_workflow_specification</span><span class="p">(</span>
                    <span class="n">api_key</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_name</span><span class="p">,</span>
                    <span class="n">workflow_id</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span>
                    <span class="n">use_cache</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">use_cache</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">process_workflow_inference_request</span><span class="p">(</span>
                <span class="n">workflow_request</span><span class="o">=</span><span class="n">workflow_request</span><span class="p">,</span>
                <span class="n">workflow_specification</span><span class="o">=</span><span class="n">workflow_specification</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/workflows/run"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to run workflow specification provided in payload"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Parses and executes workflow specification, injecting runtime parameters from request body."</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/infer/workflows"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowInferenceResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to run workflow specification provided in payload"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Parses and executes workflow specification, injecting runtime parameters from request body. This endpoint is deprecated and will be removed end of Q2 2024."</span><span class="p">,</span>
            <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">infer_from_workflow</span><span class="p">(</span>
            <span class="n">workflow_request</span><span class="p">:</span> <span class="n">WorkflowSpecificationInferenceRequest</span><span class="p">,</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowInferenceResponse</span><span class="p">:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="k">if</span> <span class="n">ENABLE_WORKFLOWS_PROFILING</span> <span class="ow">and</span> <span class="n">workflow_request</span><span class="o">.</span><span class="n">enable_profiling</span><span class="p">:</span>
                <span class="n">profiler</span> <span class="o">=</span> <span class="n">BaseWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                    <span class="n">max_runs_in_buffer</span><span class="o">=</span><span class="n">WORKFLOWS_PROFILER_BUFFER_SIZE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">profiler</span> <span class="o">=</span> <span class="n">NullWorkflowsProfiler</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">process_workflow_inference_request</span><span class="p">(</span>
                <span class="n">workflow_request</span><span class="o">=</span><span class="n">workflow_request</span><span class="p">,</span>
                <span class="n">workflow_specification</span><span class="o">=</span><span class="n">workflow_request</span><span class="o">.</span><span class="n">specification</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">profiler</span><span class="o">=</span><span class="n">profiler</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/workflows/execution_engine/versions"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ExecutionEngineVersions</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Returns available Execution Engine versions sorted from oldest to newest"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Returns available Execution Engine versions sorted from oldest to newest"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">get_execution_engine_versions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ExecutionEngineVersions</span><span class="p">:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="n">get_available_versions</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ExecutionEngineVersions</span><span class="p">(</span><span class="n">versions</span><span class="o">=</span><span class="n">versions</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[LEGACY] Endpoint to get definition of workflows blocks that are accessible"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides detailed information about workflows building blocks that are "</span>
            <span class="s2">"accessible in the inference server. This information could be used to programmatically "</span>
            <span class="s2">"build / display workflows."</span><span class="p">,</span>
            <span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflows_blocks</span><span class="p">(</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">handle_describe_workflows_blocks_request</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">gzip_response_if_requested</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/workflows/blocks/describe"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to get definition of workflows blocks that are accessible"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides detailed information about workflows building blocks that are "</span>
            <span class="s2">"accessible in the inference server. This information could be used to programmatically "</span>
            <span class="s2">"build / display workflows. Additionally - in request body one can specify list of "</span>
            <span class="s2">"dynamic blocks definitions which will be transformed into blocks and used to generate "</span>
            <span class="s2">"schemas and definitions of connections"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">describe_workflows_blocks</span><span class="p">(</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
            <span class="n">request_payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DescribeBlocksRequest</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">WorkflowsBlocksDescription</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="n">dynamic_blocks_definitions</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">requested_execution_engine_version</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">request_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dynamic_blocks_definitions</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">request_payload</span><span class="o">.</span><span class="n">dynamic_blocks_definitions</span>
                <span class="p">)</span>
                <span class="n">requested_execution_engine_version</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">request_payload</span><span class="o">.</span><span class="n">execution_engine_version</span>
                <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">handle_describe_workflows_blocks_request</span><span class="p">(</span>
                <span class="n">dynamic_blocks_definitions</span><span class="o">=</span><span class="n">dynamic_blocks_definitions</span><span class="p">,</span>
                <span class="n">requested_execution_engine_version</span><span class="o">=</span><span class="n">requested_execution_engine_version</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">gzip_response_if_requested</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/workflows/definition/schema"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowsBlocksSchemaDescription</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Endpoint to fetch the workflows block schema"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint to fetch the schema of all available blocks. This information can be "</span>
            <span class="s2">"used to validate workflow definitions and suggest syntax in the JSON editor."</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">get_workflow_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">WorkflowsBlocksSchemaDescription</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_workflow_schema_description</span><span class="p">()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/workflows/blocks/dynamic_outputs"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">OutputDefinition</span><span class="p">],</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to get definition of dynamic output for workflow step"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint to be used when step outputs can be discovered only after "</span>
            <span class="s2">"filling manifest with data."</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">get_dynamic_block_outputs</span><span class="p">(</span>
            <span class="n">step_manifest</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputDefinition</span><span class="p">]:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="c1"># Potentially TODO: dynamic blocks do not support dynamic outputs, but if it changes</span>
            <span class="c1"># we need to provide dynamic blocks manifests here</span>
            <span class="n">dummy_workflow_definition</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0"</span><span class="p">,</span>
                <span class="s2">"inputs"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">"steps"</span><span class="p">:</span> <span class="p">[</span><span class="n">step_manifest</span><span class="p">],</span>
                <span class="s2">"outputs"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>
            <span class="n">available_blocks</span> <span class="o">=</span> <span class="n">load_workflow_blocks</span><span class="p">()</span>
            <span class="n">parsed_definition</span> <span class="o">=</span> <span class="n">parse_workflow_definition</span><span class="p">(</span>
                <span class="n">raw_workflow_definition</span><span class="o">=</span><span class="n">dummy_workflow_definition</span><span class="p">,</span>
                <span class="n">available_blocks</span><span class="o">=</span><span class="n">available_blocks</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">parsed_manifest</span> <span class="o">=</span> <span class="n">parsed_definition</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">parsed_manifest</span><span class="o">.</span><span class="n">get_actual_outputs</span><span class="p">()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/workflows/validate"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">WorkflowValidationStatus</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Endpoint to validate"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoint provides a way to check validity of JSON workflow definition."</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">validate_workflow</span><span class="p">(</span>
            <span class="n">specification</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WorkflowValidationStatus</span><span class="p">:</span>
            <span class="c1"># TODO: get rid of async: https://github.com/roboflow/inference/issues/569</span>
            <span class="n">step_execution_mode</span> <span class="o">=</span> <span class="n">StepExecutionMode</span><span class="p">(</span><span class="n">WORKFLOWS_STEP_EXECUTION_MODE</span><span class="p">)</span>
            <span class="n">workflow_init_parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"workflows_core.model_manager"</span><span class="p">:</span> <span class="n">model_manager</span><span class="p">,</span>
                <span class="s2">"workflows_core.api_key"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">"workflows_core.background_tasks"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">"workflows_core.step_execution_mode"</span><span class="p">:</span> <span class="n">step_execution_mode</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">ExecutionEngine</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">workflow_definition</span><span class="o">=</span><span class="n">specification</span><span class="p">,</span>
                <span class="n">init_parameters</span><span class="o">=</span><span class="n">workflow_init_parameters</span><span class="p">,</span>
                <span class="n">max_concurrent_steps</span><span class="o">=</span><span class="n">WORKFLOWS_MAX_CONCURRENT_STEPS</span><span class="p">,</span>
                <span class="n">prevent_local_images_loading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">WorkflowValidationStatus</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">"ok"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ENABLE_STREAM_API</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/list"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ListPipelinesResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] List active InferencePipelines"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Listing all active InferencePipelines processing videos"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">list_pipelines</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ListPipelinesResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">list_pipelines</span><span class="p">()</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/status"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">InferencePipelineStatusResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Get status of InferencePipeline"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Get status of InferencePipeline"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferencePipelineStatusResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/initialise"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Starts new InferencePipeline"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Starts new InferencePipeline"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">InitialisePipelinePayload</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">initialise_pipeline</span><span class="p">(</span>
                <span class="n">initialisation_request</span><span class="o">=</span><span class="n">request</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/initialise_webrtc"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">InitializeWebRTCPipelineResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Establishes WebRTC peer connection and starts new InferencePipeline consuming video track"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Establishes WebRTC peer connection and starts new InferencePipeline consuming video track"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">initialise_webrtc_inference_pipeline</span><span class="p">(</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">InitialiseWebRTCPipelinePayload</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">initialise_webrtc_pipeline</span><span class="p">(</span>
                <span class="n">initialisation_request</span><span class="o">=</span><span class="n">request</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">resp</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/pause"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Pauses the InferencePipeline"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Pauses the InferencePipeline"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">pause_pipeline</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/resume"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Resumes the InferencePipeline"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Resumes the InferencePipeline"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">resume_pipeline</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/terminate"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">CommandResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Terminates the InferencePipeline"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Terminates the InferencePipeline"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResponse</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">terminate_pipeline</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span>
            <span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/inference_pipelines/</span><span class="si">{pipeline_id}</span><span class="s2">/consume"</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">ConsumePipelineResponse</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Consumes InferencePipeline result"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"[EXPERIMENTAL] Consumes InferencePipeline result"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span>
            <span class="n">pipeline_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConsumeResultsPayload</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConsumePipelineResponse</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">ConsumeResultsPayload</span><span class="p">()</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_manager_client</span><span class="o">.</span><span class="n">consume_pipeline_result</span><span class="p">(</span>
                <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">,</span>
                <span class="n">excluded_fields</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">excluded_fields</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">CORE_MODELS_ENABLED</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">CORE_MODEL_CLIP_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/embed_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Image Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipImageEmbeddingRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ClipImageEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ClipEmbeddingResponse: The response containing the embedded image.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/embed_image"</span><span class="p">)</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/embed_text"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ClipEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Text Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to embed text data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_embed_text</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipTextEmbeddingRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds text data using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ClipTextEmbeddingRequest): The request containing the text to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ClipEmbeddingResponse: The response containing the embedded text.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/embed_text"</span><span class="p">)</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/clip/compare"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ClipCompareResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CLIP Compare"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Open AI CLIP model to compute similarity scores."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">clip_compare</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">ClipCompareRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Computes similarity scores using the OpenAI CLIP model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (ClipCompareRequest): The request containing the data to be compared.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ClipCompareResponse: The response containing the similarity scores.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clip/compare"</span><span class="p">)</span>
                <span class="n">clip_model_id</span> <span class="o">=</span> <span class="n">load_clip_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">clip_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">clip_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_GROUNDINGDINO_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/grounding_dino/infer"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Grounding DINO inference."</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Grounding DINO zero-shot object detection model."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">grounding_dino_infer</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">GroundingDINOInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the Grounding DINO model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request GroundingDINOInferenceRequest): The request containing the image on which to run object detection.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ObjectDetectionInferenceResponse: The object detection response.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /grounding_dino/infer"</span><span class="p">)</span>
                <span class="n">grounding_dino_model_id</span> <span class="o">=</span> <span class="n">load_grounding_dino_model</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">grounding_dino_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">grounding_dino_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_YOLO_WORLD_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/yolo_world/infer"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"YOLO-World inference."</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the YOLO-World zero-shot object detection model."</span><span class="p">,</span>
                <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">yolo_world_infer</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">YOLOWorldInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Runs the YOLO-World zero-shot object detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (YOLOWorldInferenceRequest): The request containing the image on which to run object detection.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    ObjectDetectionInferenceResponse: The object detection response.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /yolo_world/infer. Loading model"</span><span class="p">)</span>
                <span class="n">yolo_world_model_id</span> <span class="o">=</span> <span class="n">load_yolo_world_model</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"YOLOWorld model loaded. Staring the inference."</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">yolo_world_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"YOLOWorld prediction available."</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">yolo_world_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Usage of YOLOWorld denoted."</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_DOCTR_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/doctr/ocr"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">OCRInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"DocTR OCR response"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the DocTR OCR model to retrieve text in an image."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">doctr_retrieve_text</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">DoctrOCRInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the DocTR model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.DoctrOCRInferenceRequest): The request containing the image from which to retrieve text.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.OCRInferenceResponse: The response containing the embedded image.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /doctr/ocr"</span><span class="p">)</span>
                <span class="n">doctr_model_id</span> <span class="o">=</span> <span class="n">load_doctr_model</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">doctr_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">doctr_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_SAM_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam/embed_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">SamEmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to embed image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_embed_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">SamEmbeddingRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.SamEmbeddingResponse or Response: The response containing the embedded image.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam/embed_image"</span><span class="p">)</span>
                <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam/segment_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">SamSegmentationResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM Image Segmentation"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segmant Anything Model to generate segmenations for image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam_segment_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">SamSegmentationRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Generates segmentations for image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (SamSegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam/segment_image"</span><span class="p">)</span>
                <span class="n">sam_model_id</span> <span class="o">=</span> <span class="n">load_sam_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">sam_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">sam_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_SAM2_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam2/embed_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Sam2EmbeddingResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM2 Image Embeddings"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segment Anything 2 Model to embed image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam2_embed_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">Sam2EmbeddingRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the Meta AI Segment Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.Sam2EmbeddingResponse or Response: The response affirming the image has been embedded</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam2/embed_image"</span><span class="p">)</span>
                <span class="n">sam2_model_id</span> <span class="o">=</span> <span class="n">load_sam2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">sam2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/sam2/segment_image"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">Sam2SegmentationResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"SAM2 Image Segmentation"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the Meta AI Segment Anything 2 Model to generate segmenations for image data."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">sam2_segment_image</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">Sam2SegmentationRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Generates segmentations for image data using the Meta AI Segment Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (Sam2SegmentationRequest): The request containing the image to be segmented.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.SamSegmentationResponse or Response: The response containing the segmented image.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /sam2/segment_image"</span><span class="p">)</span>
                <span class="n">sam2_model_id</span> <span class="o">=</span> <span class="n">load_sam2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">sam2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">inference_request</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"binary"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">model_response</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/octet-stream"</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_OWLV2_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/owlv2/infer"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Owlv2 image prompting"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the google owlv2 model to few-shot object detect"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">owlv2_infer</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">OwlV2InferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Embeds image data using the Meta AI Segmant Anything Model (SAM).</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (SamEmbeddingRequest): The request containing the image to be embedded.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.Sam2EmbeddingResponse or Response: The response affirming the image has been embedded</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /owlv2/infer"</span><span class="p">)</span>
                <span class="n">owl2_model_id</span> <span class="o">=</span> <span class="n">load_owlv2_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">model_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">owl2_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">model_response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_GAZE_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/gaze/gaze_detection"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">GazeDetectionInferenceResponse</span><span class="p">],</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"Gaze Detection"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the gaze detection model to detect gaze."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">gaze_detection</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">GazeDetectionInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Detect gaze using the gaze detection model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.GazeDetectionRequest): The request containing the image to be detected.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.GazeDetectionResponse: The response containing all the detected faces and the corresponding gazes.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /gaze/gaze_detection"</span><span class="p">)</span>
                <span class="n">gaze_model_id</span> <span class="o">=</span> <span class="n">load_gaze_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">gaze_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">gaze_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_COGVLM_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/llm/cogvlm"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">CogVLMResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"CogVLM"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the CogVLM model to chat or describe an image."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">cog_vlm</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">CogVLMInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Chat with CogVLM or ask it about an image. Multi-image requests not currently supported.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (M.CogVLMInferenceRequest): The request containing the prompt and image to be described.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    M.CogVLMResponse: The model's text response</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /llm/cogvlm"</span><span class="p">)</span>
                <span class="n">cog_model_id</span> <span class="o">=</span> <span class="n">load_cogvlm_model</span><span class="p">(</span><span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">cog_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">cog_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="k">if</span> <span class="n">CORE_MODEL_TROCR_ENABLED</span><span class="p">:</span>

            <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">"/ocr/trocr"</span><span class="p">,</span>
                <span class="n">response_model</span><span class="o">=</span><span class="n">OCRInferenceResponse</span><span class="p">,</span>
                <span class="n">summary</span><span class="o">=</span><span class="s2">"TrOCR OCR response"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Run the TrOCR model to retrieve text in an image."</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nd">@with_route_exceptions</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">trocr_retrieve_text</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="p">:</span> <span class="n">TrOCRInferenceRequest</span><span class="p">,</span>
                <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Retrieves text from image data using the TrOCR model.</span>

<span class="sd">                Args:</span>
<span class="sd">                    inference_request (TrOCRInferenceRequest): The request containing the image from which to retrieve text.</span>
<span class="sd">                    api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                    request (Request, default Body()): The HTTP request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    OCRInferenceResponse: The response containing the retrieved text.</span>
<span class="sd">                """</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /trocr/ocr"</span><span class="p">)</span>
                <span class="n">trocr_model_id</span> <span class="o">=</span> <span class="n">load_trocr_model</span><span class="p">(</span>
                    <span class="n">inference_request</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                    <span class="n">trocr_model_id</span><span class="p">,</span> <span class="n">inference_request</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                    <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span>
                        <span class="s2">"authorizer"</span>
                    <span class="p">][</span><span class="s2">"lambda"</span><span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">trocr_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/notebook/start"</span><span class="p">,</span>
            <span class="n">summary</span><span class="o">=</span><span class="s2">"Jupyter Lab Server Start"</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">"Starts a jupyter lab server for running development code"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">notebook_start</span><span class="p">(</span><span class="n">browserless</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Starts a jupyter lab server for running development code.</span>

<span class="sd">            Args:</span>
<span class="sd">                inference_request (NotebookStartRequest): The request containing the necessary details for starting a jupyter lab server.</span>
<span class="sd">                background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>

<span class="sd">            Returns:</span>
<span class="sd">                NotebookStartResponse: The response containing the URL of the jupyter lab server.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /notebook/start"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">NOTEBOOK_ENABLED</span><span class="p">:</span>
                <span class="n">start_notebook</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">browserless</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="s2">"success"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">"message"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Jupyter Lab server started at http://localhost:</span><span class="si">{</span><span class="n">NOTEBOOK_PORT</span><span class="si">}</span><span class="s2">?token=</span><span class="si">{</span><span class="n">NOTEBOOK_PASSWORD</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"http://localhost:</span><span class="si">{</span><span class="n">NOTEBOOK_PORT</span><span class="si">}</span><span class="s2">/lab/tree/quickstart.ipynb?token=</span><span class="si">{</span><span class="n">NOTEBOOK_PASSWORD</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">browserless</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Notebook server is not enabled. Enable notebooks via the NOTEBOOK_ENABLED environment variable."</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">RedirectResponse</span><span class="p">(</span><span class="sa">f</span><span class="s2">"/notebook-instructions.html"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">LEGACY_ROUTE_ENABLED</span><span class="p">:</span>

        <span class="k">class</span> <span class="nc">IntStringConvertor</span><span class="p">(</span><span class="n">StringConvertor</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Match digits but keep them as string.</span>
<span class="sd">            """</span>

            <span class="n">regex</span> <span class="o">=</span> <span class="s2">"\d+"</span>

        <span class="n">register_url_convertor</span><span class="p">(</span><span class="s2">"int_string"</span><span class="p">,</span> <span class="n">IntStringConvertor</span><span class="p">())</span>

        <span class="c1"># Legacy object detection inference path for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/{version_id:int_string}"</span><span class="p">,</span>
            <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                <span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">StubResponse</span><span class="p">,</span>
                <span class="n">Any</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">"/</span><span class="si">{dataset_id}</span><span class="s2">/{version_id:int_string}"</span><span class="p">,</span>
            <span class="c1"># Order matters in this response model Union. It will use the first matching model. For example, Object Detection Inference Response is a subset of Instance segmentation inference response, so instance segmentation must come first in order for the matching logic to work.</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">InstanceSegmentationInferenceResponse</span><span class="p">,</span>
                <span class="n">KeypointsDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">ObjectDetectionInferenceResponse</span><span class="p">,</span>
                <span class="n">ClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">MultiLabelClassificationInferenceResponse</span><span class="p">,</span>
                <span class="n">StubResponse</span><span class="p">,</span>
                <span class="n">Any</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nd">@with_route_exceptions</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_infer_from_request</span><span class="p">(</span>
            <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">,</span>
            <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
            <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset corresponding to the model to use for inference"</span>
            <span class="p">),</span>
            <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"ID of a Roboflow dataset version corresponding to the model to use for inference"</span>
            <span class="p">),</span>
            <span class="n">api_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Roboflow API Key that will be passed to the model during initialization for artifact retrieval"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.4</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out predictions"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">keypoint_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The confidence threshold used to filter out keypoints that are not visible based on model confidence"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"json"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'json' or 'image'. If 'json' prediction data is return as a JSON string. If 'image' prediction data is visualized and overlayed on the original input image."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The publically accessible URL of an image to use for inference."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">image_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"base64"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of base64 or numpy. Note, numpy input is not supported for Roboflow Hosted Inference."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If true, labels will be include in any inference visualization."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">mask_decode_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"accurate"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"One of 'accurate' or 'fast'. If 'accurate' the mask will be decoded using the original image size. If 'fast' the mask will be decoded using the original mask size. 'accurate' is slower but more accurate."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">tradeoff_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.0</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The amount to tradeoff between 0='fast' and 1='accurate'"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">max_detections</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mi">300</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The maximum number of detections to return. This is used to limit the number of predictions returned by the model. The model may return more predictions than this number, but only the top `max_detections` predictions will be returned."</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The IoU threhsold that must be met for a box pair to be considered duplicate during NMS"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">stroke</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"The stroke width used when visualizing predictions"</span>
            <span class="p">),</span>
            <span class="n">countinference</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If false, does not track inference against usage."</span><span class="p">,</span>
                <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">service_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Shared secret used to authenticate requests to the inference server from internal services (e.g. to allow disabling inference usage tracking via the `countinference` query parameter)"</span><span class="p">,</span>
                <span class="n">include_in_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable_preproc_auto_orient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic image orientation"</span>
            <span class="p">),</span>
            <span class="n">disable_preproc_contrast</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic contrast adjustment"</span>
            <span class="p">),</span>
            <span class="n">disable_preproc_grayscale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic grayscale conversion"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">disable_preproc_static_crop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"If true, disables automatic static crop"</span>
            <span class="p">),</span>
            <span class="n">disable_active_learning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"If true, the predictions will be prevented from registration by Active Learning (if the functionality is enabled)"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">active_learning_target_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"Parameter to be used when Active Learning data registration should happen against different dataset than the one pointed by model_id"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"external"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The source of the inference request"</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">source_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
                <span class="s2">"external"</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">"The detailed source information of the inference request"</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Legacy inference endpoint for object detection, instance segmentation, and classification.</span>

<span class="sd">            Args:</span>
<span class="sd">                background_tasks: (BackgroundTasks) pool of fastapi background tasks</span>
<span class="sd">                dataset_id (str): ID of a Roboflow dataset corresponding to the model to use for inference.</span>
<span class="sd">                version_id (str): ID of a Roboflow dataset version corresponding to the model to use for inference.</span>
<span class="sd">                api_key (Optional[str], default None): Roboflow API Key passed to the model during initialization for artifact retrieval.</span>
<span class="sd">                # Other parameters described in the function signature...</span>

<span class="sd">            Returns:</span>
<span class="sd">                Union[InstanceSegmentationInferenceResponse, KeypointsDetectionInferenceRequest, ObjectDetectionInferenceResponse, ClassificationInferenceResponse, MultiLabelClassificationInferenceResponse, Any]: The response containing the inference results.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Reached legacy route /:dataset_id/:version_id with </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">confidence</span> <span class="o">/=</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">confidence</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.01</span>

            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">overlap</span> <span class="o">/=</span> <span class="mi">100</span>

            <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"url"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"Content-Type"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ContentTypeMissing</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Request must include a Content-Type header"</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">"multipart/form-data"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]:</span>
                    <span class="n">form_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
                    <span class="n">base64_image_str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">form_data</span><span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">base64_image_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">base64_image_str</span><span class="p">)</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">"base64"</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">base64_image_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"ascii"</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="s2">"application/x-www-form-urlencoded"</span>
                    <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="s2">"application/json"</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">()</span>
                    <span class="n">request_image</span> <span class="o">=</span> <span class="n">InferenceRequestImage</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ContentTypeInvalid</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Invalid Content-Type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">countinference</span> <span class="ow">and</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                    <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">LAMBDA</span><span class="p">:</span>
                <span class="n">request_model_id</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                        <span class="s2">"lambda"</span>
                    <span class="p">][</span><span class="s2">"model"</span><span class="p">][</span><span class="s2">"endpoint"</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"--"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"rf-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"nu-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">actor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">[</span><span class="s2">"aws.event"</span><span class="p">][</span><span class="s2">"requestContext"</span><span class="p">][</span><span class="s2">"authorizer"</span><span class="p">][</span>
                    <span class="s2">"lambda"</span>
                <span class="p">][</span><span class="s2">"actor"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">countinference</span><span class="p">:</span>
                    <span class="n">trackUsage</span><span class="p">(</span><span class="n">request_model_id</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">service_secret</span> <span class="o">!=</span> <span class="n">ROBOFLOW_SERVICE_SECRET</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MissingServiceSecretError</span><span class="p">(</span>
                            <span class="s2">"Service secret is required to disable inference usage tracking"</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">request_model_id</span> <span class="o">=</span> <span class="n">model_id</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"State of model registry: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">describe_models</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span>
                <span class="n">request_model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">model_id_alias</span><span class="o">=</span><span class="n">model_id</span>
            <span class="p">)</span>

            <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">get_task_type</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">ObjectDetectionInferenceRequest</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"instance-segmentation"</span><span class="p">:</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">InstanceSegmentationInferenceRequest</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"mask_decode_mode"</span><span class="p">:</span> <span class="n">mask_decode_mode</span><span class="p">,</span>
                    <span class="s2">"tradeoff_factor"</span><span class="p">:</span> <span class="n">tradeoff_factor</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"classification"</span><span class="p">:</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">ClassificationInferenceRequest</span>
            <span class="k">elif</span> <span class="n">task_type</span> <span class="o">==</span> <span class="s2">"keypoint-detection"</span><span class="p">:</span>
                <span class="n">inference_request_type</span> <span class="o">=</span> <span class="n">KeypointsDetectionInferenceRequest</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"keypoint_confidence"</span><span class="p">:</span> <span class="n">keypoint_confidence</span><span class="p">}</span>
            <span class="n">inference_request</span> <span class="o">=</span> <span class="n">inference_request_type</span><span class="p">(</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">request_image</span><span class="p">,</span>
                <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                <span class="n">iou_threshold</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                <span class="n">max_detections</span><span class="o">=</span><span class="n">max_detections</span><span class="p">,</span>
                <span class="n">visualization_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">visualization_stroke_width</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                <span class="n">visualize_predictions</span><span class="o">=</span><span class="p">(</span>
                    <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image_and_json"</span>
                <span class="p">),</span>
                <span class="n">disable_preproc_auto_orient</span><span class="o">=</span><span class="n">disable_preproc_auto_orient</span><span class="p">,</span>
                <span class="n">disable_preproc_contrast</span><span class="o">=</span><span class="n">disable_preproc_contrast</span><span class="p">,</span>
                <span class="n">disable_preproc_grayscale</span><span class="o">=</span><span class="n">disable_preproc_grayscale</span><span class="p">,</span>
                <span class="n">disable_preproc_static_crop</span><span class="o">=</span><span class="n">disable_preproc_static_crop</span><span class="p">,</span>
                <span class="n">disable_active_learning</span><span class="o">=</span><span class="n">disable_active_learning</span><span class="p">,</span>
                <span class="n">active_learning_target_dataset</span><span class="o">=</span><span class="n">active_learning_target_dataset</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">source_info</span><span class="o">=</span><span class="n">source_info</span><span class="p">,</span>
                <span class="n">usage_billable</span><span class="o">=</span><span class="n">countinference</span><span class="p">,</span>
                <span class="o">**</span><span class="n">args</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">inference_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">infer_from_request</span><span class="p">(</span>
                <span class="n">inference_request</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
                <span class="n">inference_request</span><span class="p">,</span>
                <span class="n">active_learning_eligible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">background_tasks</span><span class="o">=</span><span class="n">background_tasks</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Response ready."</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">inference_response</span><span class="o">.</span><span class="n">visualization</span><span class="p">,</span>
                    <span class="n">media_type</span><span class="o">=</span><span class="s2">"image/jpeg"</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">orjson_response</span><span class="p">(</span><span class="n">inference_response</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">LAMBDA</span><span class="p">:</span>
        <span class="c1"># Legacy clear cache endpoint for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/clear_cache"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">legacy_clear_cache</span><span class="p">():</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Clears the model cache.</span>

<span class="sd">            This endpoint provides a way to clear the cache of loaded models.</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: A string indicating that the cache has been cleared.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reached /clear_cache"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">model_clear</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">"Cache Cleared"</span>

        <span class="c1"># Legacy add model endpoint for backwards compatability</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/start/</span><span class="si">{dataset_id}</span><span class="s2">/</span><span class="si">{version_id}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">model_add</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Starts a model inference session.</span>

<span class="sd">            This endpoint initializes and starts an inference session for the specified model version.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataset_id (str): ID of a Roboflow dataset corresponding to the model.</span>
<span class="sd">                version_id (str): ID of a Roboflow dataset version corresponding to the model.</span>
<span class="sd">                api_key (str, optional): Roboflow API Key for artifact retrieval.</span>

<span class="sd">            Returns:</span>
<span class="sd">                JSONResponse: A response object containing the status and a success message.</span>
<span class="sd">            """</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Reached /start/</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="n">model_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">"</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model_id</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">"status"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"inference session started from local memory."</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span>
        <span class="s2">"/"</span><span class="p">,</span>
        <span class="n">StaticFiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s2">"./inference/landing/out"</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"static"</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="inference.core.interfaces.http.http_api.with_route_exceptions">
<code class="highlight language-python"><span class="n">with_route_exceptions</span><span class="p">(</span><span class="n">route</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.http.http_api.with_route_exceptions" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>A decorator that wraps a FastAPI route to handle specific exceptions. If an exception
is caught, it returns a JSON response with the error message.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>route</code>
</td>
<td>
<code>Callable</code>
</td>
<td>
<div class="doc-md-description">
<p>The FastAPI route to be wrapped.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>Callable</code></td> <td>
</td>
<td>
<div class="doc-md-description">
<p>The wrapped route.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/http/http_api.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_route_exceptions</span><span class="p">(</span><span class="n">route</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A decorator that wraps a FastAPI route to handle specific exceptions. If an exception</span>
<span class="sd">    is caught, it returns a JSON response with the error message.</span>

<span class="sd">    Args:</span>
<span class="sd">        route (Callable): The FastAPI route to be wrapped.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable: The wrapped route.</span>
<span class="sd">    """</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapped_route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">route</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ContentTypeInvalid</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Invalid Content-Type header provided with request."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ContentTypeMissing</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Content-Type header not provided with request."</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InputImageLoadError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Could not load input image. Cause: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">get_public_error_details</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InvalidModelIDError</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Invalid Model ID sent in request."</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InvalidMaskDecodeArgument</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Invalid mask decode argument sent. tradeoff_factor must be in [0.0, 1.0], "</span>
                    <span class="s2">"mask_decode_mode: must be one of ['accurate', 'fast', 'tradeoff']"</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">MissingApiKeyError</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Required Roboflow API key is missing. Visit https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key "</span>
                    <span class="s2">"to learn how to retrieve one."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">WorkflowDefinitionError</span><span class="p">,</span>
            <span class="n">ExecutionGraphStructureError</span><span class="p">,</span>
            <span class="n">ReferenceTypeError</span><span class="p">,</span>
            <span class="n">InvalidReferenceTargetError</span><span class="p">,</span>
            <span class="n">RuntimeInputError</span><span class="p">,</span>
            <span class="n">InvalidInputTypeError</span><span class="p">,</span>
            <span class="n">OperationTypeNotRecognisedError</span><span class="p">,</span>
            <span class="n">DynamicBlockError</span><span class="p">,</span>
            <span class="n">WorkflowExecutionEngineVersionError</span><span class="p">,</span>
            <span class="n">NotSupportedExecutionEngineError</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">public_message</span><span class="p">,</span>
                    <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"context"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
                    <span class="s2">"inner_error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">inner_error_type</span><span class="p">,</span>
                    <span class="s2">"inner_error_message"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">inner_error</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">ProcessesManagerInvalidPayload</span><span class="p">,</span>
            <span class="n">MalformedPayloadError</span><span class="p">,</span>
            <span class="n">MessageToBigError</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">public_message</span><span class="p">,</span>
                    <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"inner_error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">inner_error_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">RoboflowAPINotAuthorizedError</span><span class="p">,</span> <span class="n">ProcessesManagerAuthorisationError</span><span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">401</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Unauthorized access to roboflow API - check API key and make sure the key is valid for "</span>
                    <span class="s2">"workspace you use. Visit https://docs.roboflow.com/api-reference/authentication#retrieve-an-api-key "</span>
                    <span class="s2">"to learn how to retrieve one."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">RoboflowAPINotNotFoundError</span><span class="p">,</span> <span class="n">InferenceModelNotFound</span><span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Requested Roboflow resource not found. Make sure that workspace, project or model "</span>
                    <span class="s2">"you referred in request exists."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ProcessesManagerNotFoundError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">public_message</span><span class="p">,</span>
                    <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"inner_error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">inner_error_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">InvalidEnvironmentVariableError</span><span class="p">,</span>
            <span class="n">MissingServiceSecretError</span><span class="p">,</span>
            <span class="n">ServiceConfigurationError</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Service misconfiguration."</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">PreProcessingError</span><span class="p">,</span>
            <span class="n">PostProcessingError</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Model configuration related to pre- or post-processing is invalid."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ModelArtefactError</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Model package is broken."</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OnnxProviderNotAvailable</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">501</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Could not find requested ONNX Runtime Provider. Check that you are using "</span>
                    <span class="s2">"the correct docker image on a supported device."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">MalformedRoboflowAPIResponseError</span><span class="p">,</span>
            <span class="n">RoboflowAPIUnsuccessfulRequestError</span><span class="p">,</span>
            <span class="n">WorkspaceLoadError</span><span class="p">,</span>
            <span class="n">MalformedWorkflowResponseError</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">502</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Internal error. Request to Roboflow API failed."</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">RoboflowAPIConnectionError</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">503</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Internal error. Could not connect to Roboflow API."</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">WorkflowError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">public_message</span><span class="p">,</span>
                    <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"context"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
                    <span class="s2">"inner_error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">inner_error_type</span><span class="p">,</span>
                    <span class="s2">"inner_error_message"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">inner_error</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">ProcessesManagerClientError</span><span class="p">,</span>
            <span class="n">CommunicationProtocolError</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"message"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">public_message</span><span class="p">,</span>
                    <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"inner_error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">inner_error_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"Internal error."</span><span class="p">})</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resp</span>

    <span class="k">return</span> <span class="n">wrapped_route</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: workflows" class="md-footer__link md-footer__link--prev" href="../handlers/workflows/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                workflows
              </div>
</div>
</a>
<a aria-label="Next: gzip" class="md-footer__link md-footer__link--next" href="../middlewares/gzip/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                gzip
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Roboflow 2024. All rights reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/roboflow" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://www.youtube.com/roboflow" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/roboflow-ai/mycompany/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/roboflow" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../../../..", "features": ["navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.indexes", "navigation.sections", "content.code.copy"], "search": "../../../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 1.0}}</script>
<script src="../../../../../../../assets/javascripts/bundle.3220b9d7.min.js"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js"></script>
<script src="../../../../../../../javascript/init_kapa_widget.js"></script>
<script src="../../../../../../../javascript/cookbooks.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>