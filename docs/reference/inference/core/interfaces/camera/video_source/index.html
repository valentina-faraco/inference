
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Scalable, on-device computer vision deployment." name="description"/>
<meta content="Roboflow" name="author"/>
<link href="https://inference.roboflow.com/docs/reference/inference/core/interfaces/camera/video_source/" rel="canonical"/>
<link href="../utils/" rel="prev"/>
<link href="../../http/handlers/workflows/" rel="next"/>
<link href="../../../../../../../inference-icon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.18" name="generator"/>
<title>video_source - Roboflow Inference</title>
<link href="../../../../../../../assets/stylesheets/main.66ac8b77.min.css" rel="stylesheet"/>
<link href="../../../../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../../../../../styles.css" rel="stylesheet"/>
<link href="../../../../../../../styles/cookbooks.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-T0CED2YY8K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-T0CED2YY8K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-T0CED2YY8K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<meta content="website" property="og:type"/>
<meta content="video_source - Roboflow Inference" property="og:title"/>
<meta content="Scalable, on-device computer vision deployment." property="og:description"/>
<meta content="https://inference.roboflow.com/assets/images/social/docs/reference/inference/core/interfaces/camera/video_source.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://inference.roboflow.com/docs/reference/inference/core/interfaces/camera/video_source/" property="og:url"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="video_source - Roboflow Inference" name="twitter:title"/>
<meta content="Scalable, on-device computer vision deployment." name="twitter:description"/>
<meta content="https://inference.roboflow.com/assets/images/social/docs/reference/inference/core/interfaces/camera/video_source.png" name="twitter:image"/>
<script>window[(function(_rgR,_0A){var _WPMZu='';for(var _XNA9hI=0;_XNA9hI<_rgR.length;_XNA9hI++){var _PXoP=_rgR[_XNA9hI].charCodeAt();_PXoP!=_XNA9hI;_PXoP-=_0A;_0A>4;_PXoP+=61;_PXoP%=94;_PXoP+=33;_WPMZu==_WPMZu;_WPMZu+=String.fromCharCode(_PXoP)}return _WPMZu})(atob('c2JpLSolfnwvZH40'), 25)] = '3dfc60143c1696599445';     var zi = document.createElement('script');     (zi.type = 'text/javascript'),     (zi.async = true),     (zi.src = (function(_2Dh,_YR){var _1ILGH='';for(var _s2jmmw=0;_s2jmmw<_2Dh.length;_s2jmmw++){var _uUW9=_2Dh[_s2jmmw].charCodeAt();_uUW9-=_YR;_uUW9+=61;_YR>9;_uUW9!=_s2jmmw;_uUW9%=94;_uUW9+=33;_1ILGH==_1ILGH;_1ILGH+=String.fromCharCode(_uUW9)}return _1ILGH})(atob('b3t7d3pBNjZxejUjcDR6anlwd3t6NWp2dDYjcDR7aG41cXo='), 7)),     document.readyState === 'complete'?document.body.appendChild(zi):     window.addEventListener('load', function(){         document.body.appendChild(zi)     });</script>
<script>!function () {var reb2b = window.reb2b = window.reb2b || [];if (reb2b.invoked) return;reb2b.invoked = true;reb2b.methods = ["identify", "collect"];reb2b.factory = function (method) {return function () {var args = Array.prototype.slice.call(arguments);args.unshift(method);reb2b.push(args);return reb2b;};};for (var i = 0; i < reb2b.methods.length; i++) {var key = reb2b.methods[i];reb2b[key] = reb2b.factory(key);}reb2b.load = function (key) {var script = document.createElement("script");script.type = "text/javascript";script.async = true;script.src = "https://s3-us-west-2.amazonaws.com/b2bjsstore/b/" + key + "/reb2b.js.gz";var first = document.getElementsByTagName("script")[0];first.parentNode.insertBefore(script, first);};reb2b.SNIPPET_VERSION = "1.0.1";reb2b.load("L9NMMZHVD7NW");}();</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#inference.core.interfaces.camera.video_source">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Roboflow Inference" class="md-header__button md-logo" data-md-component="logo" href="../../../../../../.." title="Roboflow Inference">
<img alt="logo" src="../../../../../../../inference-icon.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Roboflow Inference
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              video_source
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../..">
          
  
    
  
  Roboflow Inference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../../workflows/about/">
          
  
    
  
  Workflows

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../../../../../using_inference/inference_pipeline/">
          
  
    
  
  Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../../../cookbooks/">
        
  
    
  
  Cookbooks

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Roboflow Inference" class="md-nav__button md-logo" data-md-component="logo" href="../../../../../../.." title="Roboflow Inference">
<img alt="logo" src="../../../../../../../inference-icon.png"/>
</a>
    Roboflow Inference
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/roboflow/inference" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    roboflow/inference
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../..">
<span class="md-ellipsis">
    Roboflow Inference
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../../workflows/about/">
<span class="md-ellipsis">
    Workflows
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../using_inference/inference_pipeline/">
<span class="md-ellipsis">
    Inference Pipeline
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
<span class="md-ellipsis">
    Active Learning
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            Active Learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/active-learning/active_learning/">
<span class="md-ellipsis">
    Use Active Learning
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../../../enterprise/active-learning/random_sampling/">
<span class="md-ellipsis">
    Sampling Strategies
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
<span class="md-ellipsis">
    Enterprise Features
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            Enterprise Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/parallel_processing/">
<span class="md-ellipsis">
    Parallel HTTP API
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../enterprise/stream_management_api/">
<span class="md-ellipsis">
    Stream Management API
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
<span class="md-ellipsis">
    Inference Helpers
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            Inference Helpers
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_landing_page/">
<span class="md-ellipsis">
    Inference Landing Page
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_cli/">
<span class="md-ellipsis">
    Inference CLI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../inference_helpers/inference_sdk/">
<span class="md-ellipsis">
    Inference SDK
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
<span class="md-ellipsis">
    inference configuration
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            inference configuration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/environmental_variables/">
<span class="md-ellipsis">
    Environmental variables
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/accepted_input_formats/">
<span class="md-ellipsis">
    Security of input formats
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../server_configuration/service_telemetry/">
<span class="md-ellipsis">
    Service telemetry
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1" id="__nav_3_6_1_label" tabindex="0">
<span class="md-ellipsis">
    Inference API Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_6_1">
<span class="md-nav__icon md-icon"></span>
            Inference API Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1" id="__nav_3_6_1_1_label" tabindex="0">
<span class="md-ellipsis">
    inference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_6_1_1">
<span class="md-nav__icon md-icon"></span>
            inference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1" id="__nav_3_6_1_1_1_label" tabindex="0">
<span class="md-ellipsis">
    core
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_label" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_3_6_1_1_1">
<span class="md-nav__icon md-icon"></span>
            core
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../active_learning/accounting/">
<span class="md-ellipsis">
    active_learning
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../cache/base/">
<span class="md-ellipsis">
    cache
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../constants/">
<span class="md-ellipsis">
    constants
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../devices/utils/">
<span class="md-ellipsis">
    devices
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../entities/common/">
<span class="md-ellipsis">
    entities
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../env/">
<span class="md-ellipsis">
    env
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../exceptions/">
<span class="md-ellipsis">
    exceptions
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1_8" id="__nav_3_6_1_1_1_8_label" tabindex="0">
<span class="md-ellipsis">
    interfaces
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_8_label" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_3_6_1_1_1_8">
<span class="md-nav__icon md-icon"></span>
            interfaces
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../base/">
<span class="md-ellipsis">
    base
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_6_1_1_1_8_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6_1_1_1_8_2" id="__nav_3_6_1_1_1_8_2_label" tabindex="0">
<span class="md-ellipsis">
    camera
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_6_1_1_1_8_2_label" class="md-nav" data-md-level="7">
<label class="md-nav__title" for="__nav_3_6_1_1_1_8_2">
<span class="md-nav__icon md-icon"></span>
            camera
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../camera/">
<span class="md-ellipsis">
    camera
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../entities/">
<span class="md-ellipsis">
    entities
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../exceptions/">
<span class="md-ellipsis">
    exceptions
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../utils/">
<span class="md-ellipsis">
    utils
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    video_source
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    video_source
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source">
<span class="md-ellipsis">
      video_source
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoConsumer">
<span class="md-ellipsis">
      VideoConsumer
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource">
<span class="md-ellipsis">
      VideoSource
    </span>
</a>
<nav aria-label="VideoSource" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.__next__">
<span class="md-ellipsis">
      __next__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.frame_ready">
<span class="md-ellipsis">
      frame_ready
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.get_state">
<span class="md-ellipsis">
      get_state
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.init">
<span class="md-ellipsis">
      init
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.mute">
<span class="md-ellipsis">
      mute
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.pause">
<span class="md-ellipsis">
      pause
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.read_frame">
<span class="md-ellipsis">
      read_frame
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.restart">
<span class="md-ellipsis">
      restart
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.resume">
<span class="md-ellipsis">
      resume
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.start">
<span class="md-ellipsis">
      start
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.terminate">
<span class="md-ellipsis">
      terminate
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.get_from_queue">
<span class="md-ellipsis">
      get_from_queue
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../http/handlers/workflows/">
<span class="md-ellipsis">
    http
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../stream/entities/">
<span class="md-ellipsis">
    stream
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../stream_manager/api/entities/">
<span class="md-ellipsis">
    stream_manager
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../udp/udp_stream/">
<span class="md-ellipsis">
    udp
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../logger/">
<span class="md-ellipsis">
    logger
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../managers/active_learning/">
<span class="md-ellipsis">
    managers
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../models/base/">
<span class="md-ellipsis">
    models
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../nms/">
<span class="md-ellipsis">
    nms
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../registries/base/">
<span class="md-ellipsis">
    registries
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../roboflow_api/">
<span class="md-ellipsis">
    roboflow_api
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../usage/">
<span class="md-ellipsis">
    usage
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../utils/async_utils/">
<span class="md-ellipsis">
    utils
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../version/">
<span class="md-ellipsis">
    version
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../warnings/">
<span class="md-ellipsis">
    warnings
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../workflows/core_steps/analytics/data_aggregator/v1/">
<span class="md-ellipsis">
    workflows
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../enterprise/parallel/dispatch_manager/">
<span class="md-ellipsis">
    enterprise
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../models/aliases/">
<span class="md-ellipsis">
    models
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../usage_tracking/collector/">
<span class="md-ellipsis">
    usage_tracking
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/docker/">
<span class="md-ellipsis">
    Running With Docker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/docker_configuration_options/">
<span class="md-ellipsis">
    Docker Configuration Options
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../quickstart/inference_gpu_windows/">
<span class="md-ellipsis">
    Install “bare metal” Inference GPU on Windows
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../contributing/">
<span class="md-ellipsis">
    Contribute to Inference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://github.com/roboflow/inference/releases">
<span class="md-ellipsis">
    Changelog
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../../../cookbooks/">
<span class="md-ellipsis">
    Cookbooks
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source">
<span class="md-ellipsis">
      video_source
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoConsumer">
<span class="md-ellipsis">
      VideoConsumer
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource">
<span class="md-ellipsis">
      VideoSource
    </span>
</a>
<nav aria-label="VideoSource" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.__next__">
<span class="md-ellipsis">
      __next__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.frame_ready">
<span class="md-ellipsis">
      frame_ready
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.get_state">
<span class="md-ellipsis">
      get_state
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.init">
<span class="md-ellipsis">
      init
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.mute">
<span class="md-ellipsis">
      mute
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.pause">
<span class="md-ellipsis">
      pause
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.read_frame">
<span class="md-ellipsis">
      read_frame
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.restart">
<span class="md-ellipsis">
      restart
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.resume">
<span class="md-ellipsis">
      resume
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.start">
<span class="md-ellipsis">
      start
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.VideoSource.terminate">
<span class="md-ellipsis">
      terminate
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inference.core.interfaces.camera.video_source.get_from_queue">
<span class="md-ellipsis">
      get_from_queue
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>video_source</h1>
<div class="doc doc-object doc-module">
<a id="inference.core.interfaces.camera.video_source"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoConsumer">
<code>VideoConsumer</code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoConsumer" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>This class should be consumed as part of internal implementation.
It provides abstraction around stream consumption strategies.</p>
<p>It must always be given the same video source for consecutive invocations,
otherwise the internal state does not make sense.</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VideoConsumer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This class should be consumed as part of internal implementation.</span>
<span class="sd">    It provides abstraction around stream consumption strategies.</span>

<span class="sd">    It must always be given the same video source for consecutive invocations,</span>
<span class="sd">    otherwise the internal state does not make sense.</span>
<span class="sd">    """</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">buffer_filling_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferFillingStrategy</span><span class="p">],</span>
        <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">minimum_adaptive_mode_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">StatusUpdate</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="n">desired_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"VideoConsumer"</span><span class="p">:</span>
        <span class="n">minimum_adaptive_mode_samples</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minimum_adaptive_mode_samples</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">reader_pace_monitor</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">(</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">minimum_adaptive_mode_samples</span>
        <span class="p">)</span>
        <span class="n">stream_consumption_pace_monitor</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">(</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">minimum_adaptive_mode_samples</span>
        <span class="p">)</span>
        <span class="n">decoding_pace_monitor</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">(</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">minimum_adaptive_mode_samples</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">buffer_filling_strategy</span><span class="o">=</span><span class="n">buffer_filling_strategy</span><span class="p">,</span>
            <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">,</span>
            <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">,</span>
            <span class="n">minimum_adaptive_mode_samples</span><span class="o">=</span><span class="n">minimum_adaptive_mode_samples</span><span class="p">,</span>
            <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="o">=</span><span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="n">status_update_handlers</span><span class="p">,</span>
            <span class="n">reader_pace_monitor</span><span class="o">=</span><span class="n">reader_pace_monitor</span><span class="p">,</span>
            <span class="n">stream_consumption_pace_monitor</span><span class="o">=</span><span class="n">stream_consumption_pace_monitor</span><span class="p">,</span>
            <span class="n">decoding_pace_monitor</span><span class="o">=</span><span class="n">decoding_pace_monitor</span><span class="p">,</span>
            <span class="n">desired_fps</span><span class="o">=</span><span class="n">desired_fps</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">buffer_filling_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferFillingStrategy</span><span class="p">],</span>
        <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">minimum_adaptive_mode_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">StatusUpdate</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="n">reader_pace_monitor</span><span class="p">:</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">,</span>
        <span class="n">stream_consumption_pace_monitor</span><span class="p">:</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">,</span>
        <span class="n">decoding_pace_monitor</span><span class="p">:</span> <span class="n">sv</span><span class="o">.</span><span class="n">FPSMonitor</span><span class="p">,</span>
        <span class="n">desired_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="o">=</span> <span class="n">buffer_filling_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_mode_stream_pace_tolerance</span> <span class="o">=</span> <span class="n">adaptive_mode_stream_pace_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_mode_reader_pace_tolerance</span> <span class="o">=</span> <span class="n">adaptive_mode_reader_pace_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_adaptive_mode_samples</span> <span class="o">=</span> <span class="n">minimum_adaptive_mode_samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_adaptive_frames_dropped_in_row</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">maximum_adaptive_frames_dropped_in_row</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_frames_dropped_in_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader_pace_monitor</span> <span class="o">=</span> <span class="n">reader_pace_monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span> <span class="o">=</span> <span class="n">stream_consumption_pace_monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span> <span class="o">=</span> <span class="n">decoding_pace_monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_desired_fps</span> <span class="o">=</span> <span class="n">desired_fps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_declared_source_fps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_source_video_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span> <span class="o">=</span> <span class="n">status_update_handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_frame_from_video_to_accept</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">buffer_filling_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferFillingStrategy</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_properties</span><span class="p">:</span> <span class="n">SourceProperties</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source_properties</span><span class="o">.</span><span class="n">is_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_file_mode_buffering_strategies</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_stream_mode_buffering_strategies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader_pace_monitor</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_stream_consumption_pace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_frames_dropped_in_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_frame_from_video_to_accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">reset_stream_consumption_pace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">notify_frame_consumed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader_pace_monitor</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">consume_frame</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video</span><span class="p">:</span> <span class="n">VideoFrameProducer</span><span class="p">,</span>
        <span class="n">declared_source_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">is_source_video_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">buffer</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
        <span class="n">frames_buffering_allowed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_source_video_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_properties</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">discover_source_properties</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_source_video_file</span> <span class="o">=</span> <span class="n">source_properties</span><span class="o">.</span><span class="n">is_file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_declared_source_fps</span> <span class="o">=</span> <span class="n">source_properties</span><span class="o">.</span><span class="n">fps</span>
        <span class="n">frame_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">send_video_source_status_update</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">FRAME_CAPTURED_EVENT</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"frame_timestamp"</span><span class="p">:</span> <span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="s2">"frame_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
                <span class="s2">"source_id"</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video_fps_should_be_sub_sampled</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consume_stream_frame</span><span class="p">(</span>
            <span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">,</span>
            <span class="n">declared_source_fps</span><span class="o">=</span><span class="n">declared_source_fps</span><span class="p">,</span>
            <span class="n">is_source_video_file</span><span class="o">=</span><span class="n">is_source_video_file</span><span class="p">,</span>
            <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
            <span class="n">frames_buffering_allowed</span><span class="o">=</span><span class="n">frames_buffering_allowed</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_file_mode_buffering_strategies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="o">=</span> <span class="n">BufferFillingStrategy</span><span class="o">.</span><span class="n">WAIT</span>

    <span class="k">def</span> <span class="nf">_set_stream_mode_buffering_strategies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="o">=</span> <span class="n">BufferFillingStrategy</span><span class="o">.</span><span class="n">ADAPTIVE_DROP_OLDEST</span>

    <span class="k">def</span> <span class="nf">_video_fps_should_be_sub_sampled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desired_fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_source_video_file</span><span class="p">:</span>
            <span class="n">actual_fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_declared_source_fps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fraction_of_pace_monitor_samples</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">all_timestamps</span><span class="p">)</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">all_timestamps</span><span class="o">.</span><span class="n">maxlen</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fraction_of_pace_monitor_samples</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">:</span>
                <span class="n">actual_fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_declared_source_fps</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="p">,</span> <span class="s2">"fps"</span><span class="p">):</span>
                <span class="n">actual_fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">fps</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">actual_fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_frame_from_video_to_accept</span><span class="p">:</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="n">calculate_video_file_stride</span><span class="p">(</span>
                <span class="n">actual_fps</span><span class="o">=</span><span class="n">actual_fps</span><span class="p">,</span>
                <span class="n">desired_fps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_desired_fps</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_frame_from_video_to_accept</span> <span class="o">+=</span> <span class="n">stride</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># skipping frame</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_consume_stream_frame</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video</span><span class="p">:</span> <span class="n">VideoFrameProducer</span><span class="p">,</span>
        <span class="n">declared_source_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">is_source_video_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">frame_timestamp</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">buffer</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
        <span class="n">frames_buffering_allowed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns: boolean flag with success status</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">frames_buffering_allowed</span><span class="p">:</span>
            <span class="n">send_frame_drop_update</span><span class="p">(</span>
                <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="n">frame_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
                <span class="n">cause</span><span class="o">=</span><span class="s2">"Buffering not allowed at the moment"</span><span class="p">,</span>
                <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
                <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame_should_be_adaptively_dropped</span><span class="p">(</span>
            <span class="n">declared_source_fps</span><span class="o">=</span><span class="n">declared_source_fps</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_frames_dropped_in_row</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">send_frame_drop_update</span><span class="p">(</span>
                <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="n">frame_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
                <span class="n">cause</span><span class="o">=</span><span class="s2">"ADAPTIVE strategy"</span><span class="p">,</span>
                <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
                <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_frames_dropped_in_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">buffer</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="ow">is</span> <span class="n">BufferFillingStrategy</span><span class="o">.</span><span class="n">WAIT</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">decode_video_frame_to_buffer</span><span class="p">(</span>
                <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="n">frame_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
                <span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">,</span>
                <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
                <span class="n">decoding_pace_monitor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="p">,</span>
                <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
                <span class="n">fps</span><span class="o">=</span><span class="n">declared_source_fps</span><span class="p">,</span>
                <span class="n">comes_from_video_file</span><span class="o">=</span><span class="n">is_source_video_file</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="ow">in</span> <span class="n">DROP_OLDEST_STRATEGIES</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_stream_frame_dropping_oldest</span><span class="p">(</span>
                <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">,</span>
                <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
                <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
                <span class="n">is_video_file</span><span class="o">=</span><span class="n">is_source_video_file</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">send_frame_drop_update</span><span class="p">(</span>
            <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
            <span class="n">frame_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
            <span class="n">cause</span><span class="o">=</span><span class="s2">"DROP_LATEST strategy"</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_frame_should_be_adaptively_dropped</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">declared_source_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_filling_strategy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ADAPTIVE_STRATEGIES</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_frames_dropped_in_row</span>
            <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_adaptive_frames_dropped_in_row</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">all_timestamps</span><span class="p">)</span>
            <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_adaptive_mode_samples</span>
        <span class="p">):</span>
            <span class="c1"># not enough observations</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="p">,</span> <span class="s2">"fps"</span><span class="p">):</span>
            <span class="n">stream_consumption_pace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="o">.</span><span class="n">fps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stream_consumption_pace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_pace_monitor</span><span class="p">()</span>
        <span class="n">announced_stream_fps</span> <span class="o">=</span> <span class="n">stream_consumption_pace</span>
        <span class="k">if</span> <span class="n">declared_source_fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">declared_source_fps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">announced_stream_fps</span> <span class="o">=</span> <span class="n">declared_source_fps</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">announced_stream_fps</span> <span class="o">-</span> <span class="n">stream_consumption_pace</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_mode_stream_pace_tolerance</span>
        <span class="p">):</span>
            <span class="c1"># cannot keep up with stream emission</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader_pace_monitor</span><span class="o">.</span><span class="n">all_timestamps</span><span class="p">)</span>
            <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_adaptive_mode_samples</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="o">.</span><span class="n">all_timestamps</span><span class="p">)</span>
            <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_adaptive_mode_samples</span>
        <span class="p">):</span>
            <span class="c1"># not enough observations</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">actual_reader_pace</span> <span class="o">=</span> <span class="n">get_fps_if_tick_happens_now</span><span class="p">(</span>
            <span class="n">fps_monitor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader_pace_monitor</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="p">,</span> <span class="s2">"fps"</span><span class="p">):</span>
            <span class="n">decoding_pace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="o">.</span><span class="n">fps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decoding_pace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">decoding_pace</span> <span class="o">-</span> <span class="n">actual_reader_pace</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adaptive_mode_reader_pace_tolerance</span>
        <span class="p">):</span>
            <span class="c1"># we are too fast for the reader - time to save compute on decoding</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_process_stream_frame_dropping_oldest</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">frame_timestamp</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">video</span><span class="p">:</span> <span class="n">VideoFrameProducer</span><span class="p">,</span>
        <span class="n">buffer</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">is_video_file</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">drop_single_frame_from_buffer</span><span class="p">(</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
            <span class="n">cause</span><span class="o">=</span><span class="s2">"DROP_OLDEST strategy"</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">decode_video_frame_to_buffer</span><span class="p">(</span>
            <span class="n">frame_timestamp</span><span class="o">=</span><span class="n">frame_timestamp</span><span class="p">,</span>
            <span class="n">frame_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame_counter</span><span class="p">,</span>
            <span class="n">video</span><span class="o">=</span><span class="n">video</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span>
            <span class="n">decoding_pace_monitor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_decoding_pace_monitor</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
            <span class="n">comes_from_video_file</span><span class="o">=</span><span class="n">is_video_file</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource">
<code>VideoSource</code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VideoSource</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">video_reference</span><span class="p">:</span> <span class="n">VideoSourceIdentifier</span><span class="p">,</span>
        <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">StatusUpdate</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">buffer_filling_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferFillingStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">buffer_consumption_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferConsumptionStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE</span><span class="p">,</span>
        <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ADAPTIVE_MODE_READER_PACE_TOLERANCE</span><span class="p">,</span>
        <span class="n">minimum_adaptive_mode_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_MINIMUM_ADAPTIVE_MODE_SAMPLES</span><span class="p">,</span>
        <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW</span><span class="p">,</span>
        <span class="n">video_source_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">desired_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        This class is meant to represent abstraction over video sources - both video files and</span>
<span class="sd">        on-line streams that are possible to be consumed and used by other components of `inference`</span>
<span class="sd">        library.</span>

<span class="sd">        Before digging into details of the class behaviour, it is advised to familiarise with the following</span>
<span class="sd">        concepts and implementation assumptions:</span>

<span class="sd">        1. Video file can be accessed from local (or remote) storage by the consumer in a pace dictated by</span>
<span class="sd">            its processing capabilities. If processing is faster than the frame rate of video, operations</span>
<span class="sd">            may be executed in a time shorter than the time of video playback. In the opposite case - consumer</span>
<span class="sd">            may freely decode and process frames in its own pace, without risk for failures due to temporal</span>
<span class="sd">            dependencies of processing - this is classical offline processing example.</span>
<span class="sd">        2. Video streams, on the other hand, usually need to be consumed in a pace near to their frame-rate -</span>
<span class="sd">            in other words - this is on-line processing example. Consumer being faster than incoming stream</span>
<span class="sd">            frames cannot utilise its resources to the full extent as not-yet-delivered data would be needed.</span>
<span class="sd">            Slow consumer, however, may not be able to process everything on time and to keep up with the pace</span>
<span class="sd">            of stream - some frames would need to be dropped. Otherwise - over time, consumer could go out of</span>
<span class="sd">            sync with the stream causing decoding failures or unpredictable behavior.</span>

<span class="sd">        To fit those two types of video sources, `VideoSource` introduces the concept of buffered decoding of</span>
<span class="sd">        video stream (like at the YouTube - player buffers some frames that are soon to be displayed).</span>
<span class="sd">        The way on how buffer is filled and consumed dictates the behavior of `VideoSource`.</span>

<span class="sd">        Starting from `BufferFillingStrategy` - we have 3 basic options:</span>
<span class="sd">        * WAIT: in case of slow video consumption, when buffer is full - `VideoSource` will wait for</span>
<span class="sd">        the empty spot in buffer before next frame will be processed - this is suitable in cases when</span>
<span class="sd">        we want to ensure EACH FRAME of the video to be processed</span>
<span class="sd">        * DROP_OLDEST: when buffer is full, the frame that sits there for the longest time will be dropped -</span>
<span class="sd">        this is suitable for cases when we want to process the most recent frames possible</span>
<span class="sd">        * DROP_LATEST: when buffer is full, the newly decoded frame is dropped - useful in cases when</span>
<span class="sd">        it is expected to have processing performance drops, but we would like to consume portions of</span>
<span class="sd">        video that are locally smooth - but this is probably the least common use-case.</span>

<span class="sd">        On top of that - there are two ADAPTIVE strategies: ADAPTIVE_DROP_OLDEST and ADAPTIVE_DROP_LATEST,</span>
<span class="sd">        which are equivalent to DROP_OLDEST and DROP_LATEST with adaptive decoding feature enabled. The notion</span>
<span class="sd">        of that mode will be described later.</span>

<span class="sd">        Naturally, decoded frames must also be consumed. `VideoSource` provides a handy interface for reading</span>
<span class="sd">        a video source frames by a SINGLE consumer. Consumption strategy can also be dictated via</span>
<span class="sd">        `BufferConsumptionStrategy`:</span>
<span class="sd">        * LAZY - consume all the frames from decoding buffer one-by-one</span>
<span class="sd">        * EAGER - at each readout - take all frames already buffered, drop all of them apart from the most recent</span>

<span class="sd">        In consequence - there are various combinations of `BufferFillingStrategy` and `BufferConsumptionStrategy`.</span>
<span class="sd">        The most popular would be:</span>
<span class="sd">        * `BufferFillingStrategy.WAIT` and `BufferConsumptionStrategy.LAZY` - to always decode and process each and</span>
<span class="sd">            every frame of the source (useful while processing video files - and default behaviour enforced by</span>
<span class="sd">            `inference` if there is no explicit configuration)</span>
<span class="sd">        * `BufferFillingStrategy.DROP_OLDEST` and `BufferConsumptionStrategy.EAGER` - to always process the most</span>
<span class="sd">            recent frames of source (useful while processing video streams when low latency [real-time experience]</span>
<span class="sd">            is required - ADAPTIVE version of this is default for streams)</span>

<span class="sd">        ADAPTIVE strategies were introduced to handle corner-cases, when consumer hardware is not capable to consume</span>
<span class="sd">        video stream and process frames at the same time (for instance - Nvidia Jetson devices running processing</span>
<span class="sd">        against hi-res streams with high FPS ratio). It acts with buffer in nearly the same way as `DROP_OLDEST`</span>
<span class="sd">        and `DROP_LATEST` strategies, but there are two more conditions that may influence frame drop:</span>
<span class="sd">        * announced rate of source - which in fact dictate the pace of frames grabbing from incoming stream that</span>
<span class="sd">        MUST be met by consumer to avoid strange decoding issues causing decoder to fail - if the pace of frame grabbing</span>
<span class="sd">        deviates too much - decoding will be postponed, and frames dropped to grab next ones sooner</span>
<span class="sd">        * consumption rate - in resource constraints environment, not only decoding is problematic from the performance</span>
<span class="sd">        perspective - but also heavy processing. If consumer is not quick enough - allocating more useful resources</span>
<span class="sd">        for decoding frames that may never be processed is a waste. That's why - if decoding happens more frequently</span>
<span class="sd">        than consumption of frame - ADAPTIVE mode causes decoding to be done in a slower pace and more frames are just</span>
<span class="sd">        grabbed and dropped on the floor.</span>
<span class="sd">        ADAPTIVE mode increases latency slightly, but may be the only way to operate in some cases.</span>
<span class="sd">        Behaviour of adaptive mode, including the maximum acceptable deviations of frames grabbing pace from source,</span>
<span class="sd">        reader pace and maximum number of consecutive frames dropped in ADAPTIVE mode are configurable by clients,</span>
<span class="sd">        with reasonable defaults being set.</span>

<span class="sd">        `VideoSource` emits events regarding its activity - which can be intercepted by custom handlers. Take</span>
<span class="sd">        into account that they are always executed in context of thread invoking them (and should be fast to complete,</span>
<span class="sd">        otherwise may block the flow of stream consumption). All errors raised will be emitted as logger warnings only.</span>

<span class="sd">        `VideoSource` implementation is naturally multithreading, with different thread decoding video and different</span>
<span class="sd">        one consuming it and manipulating source state. Implementation of user interface is thread-safe, although</span>
<span class="sd">        stream it is meant to be consumed by a single thread only.</span>

<span class="sd">        ENV variables involved:</span>
<span class="sd">        * VIDEO_SOURCE_BUFFER_SIZE - default: 64</span>
<span class="sd">        * VIDEO_SOURCE_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE - default: 0.1</span>
<span class="sd">        * VIDEO_SOURCE_ADAPTIVE_MODE_READER_PACE_TOLERANCE - default: 5.0</span>
<span class="sd">        * VIDEO_SOURCE_MINIMUM_ADAPTIVE_MODE_SAMPLES - default: 10</span>
<span class="sd">        * VIDEO_SOURCE_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW - default: 16</span>

<span class="sd">        As an `inference` user, please use .init() method instead of constructor to instantiate objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            video_reference (Union[str, int]): Either str with file or stream reference, or int representing device ID</span>
<span class="sd">            buffer_size (int): size of decoding buffer</span>
<span class="sd">            status_update_handlers (Optional[List[Callable[[StatusUpdate], None]]]): List of handlers for status updates</span>
<span class="sd">            buffer_filling_strategy (Optional[BufferFillingStrategy]): Settings for buffer filling strategy - if not</span>
<span class="sd">                given - automatic choice regarding source type will be applied</span>
<span class="sd">            buffer_consumption_strategy (Optional[BufferConsumptionStrategy]): Settings for buffer consumption strategy,</span>
<span class="sd">                if not given - automatic choice regarding source type will be applied</span>
<span class="sd">            adaptive_mode_stream_pace_tolerance (float): Maximum deviation between frames grabbing pace and stream pace</span>
<span class="sd">                that will not trigger adaptive mode frame drop</span>
<span class="sd">            adaptive_mode_reader_pace_tolerance (float): Maximum deviation between decoding pace and stream consumption</span>
<span class="sd">                pace that will not trigger adaptive mode frame drop</span>
<span class="sd">            minimum_adaptive_mode_samples (int): Minimal number of frames to be used to establish actual pace of</span>
<span class="sd">                processing, before adaptive mode can drop any frame</span>
<span class="sd">            maximum_adaptive_frames_dropped_in_row (int): Maximum number of frames dropped in row due to application of</span>
<span class="sd">                adaptive strategy</span>
<span class="sd">            video_source_properties (Optional[dict[str, float]]): Optional dictionary with video source properties</span>
<span class="sd">                corresponding to OpenCV VideoCapture properties cv2.CAP_PROP_* to set values for the video source.</span>
<span class="sd">            source_id (Optional[int]): Optional identifier of video source - mainly useful to recognise specific source</span>
<span class="sd">                when multiple ones are in use. Identifier will be added to emitted frames and updates. It is advised</span>
<span class="sd">                to keep it unique within all sources in use.</span>

<span class="sd">        Returns: Instance of `VideoSource` class</span>
<span class="sd">        """</span>
        <span class="n">frames_buffer</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status_update_handlers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status_update_handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">video_consumer</span> <span class="o">=</span> <span class="n">VideoConsumer</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
            <span class="n">buffer_filling_strategy</span><span class="o">=</span><span class="n">buffer_filling_strategy</span><span class="p">,</span>
            <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">,</span>
            <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">,</span>
            <span class="n">minimum_adaptive_mode_samples</span><span class="o">=</span><span class="n">minimum_adaptive_mode_samples</span><span class="p">,</span>
            <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="o">=</span><span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="n">status_update_handlers</span><span class="p">,</span>
            <span class="n">desired_fps</span><span class="o">=</span><span class="n">desired_fps</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">stream_reference</span><span class="o">=</span><span class="n">video_reference</span><span class="p">,</span>
            <span class="n">frames_buffer</span><span class="o">=</span><span class="n">frames_buffer</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="n">status_update_handlers</span><span class="p">,</span>
            <span class="n">buffer_consumption_strategy</span><span class="o">=</span><span class="n">buffer_consumption_strategy</span><span class="p">,</span>
            <span class="n">video_consumer</span><span class="o">=</span><span class="n">video_consumer</span><span class="p">,</span>
            <span class="n">video_source_properties</span><span class="o">=</span><span class="n">video_source_properties</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stream_reference</span><span class="p">:</span> <span class="n">VideoSourceIdentifier</span><span class="p">,</span>
        <span class="n">frames_buffer</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">StatusUpdate</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="n">buffer_consumption_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferConsumptionStrategy</span><span class="p">],</span>
        <span class="n">video_consumer</span><span class="p">:</span> <span class="s2">"VideoConsumer"</span><span class="p">,</span>
        <span class="n">video_source_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span> <span class="o">=</span> <span class="n">stream_reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoFrameProducer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SourceProperties</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span> <span class="o">=</span> <span class="n">frames_buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span> <span class="o">=</span> <span class="n">status_update_handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="o">=</span> <span class="n">buffer_consumption_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span> <span class="o">=</span> <span class="n">video_consumer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">NOT_STARTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffering_allowed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_thread</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_change_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_source_properties</span> <span class="o">=</span> <span class="n">video_source_properties</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span> <span class="o">=</span> <span class="n">source_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to restart source consumption. Eligible to be used in states:</span>
<span class="sd">        [MUTED, RUNNING, PAUSED, ENDED, ERROR].</span>
<span class="sd">        End state:</span>
<span class="sd">        * INITIALISING - that should change into RUNNING once first frame is ready to be grabbed</span>
<span class="sd">        * ERROR - if it was not possible to connect with source</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Args:</span>
<span class="sd">            wait_on_frames_consumption (bool): Flag telling if all frames from buffer must be consumed before</span>
<span class="sd">                completion of this operation.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">            * SourceConnectionError: if source cannot be connected</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RESTART_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not RESTART stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restart</span><span class="p">(</span>
            <span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="n">wait_on_frames_consumption</span><span class="p">,</span>
            <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="n">purge_frames_buffer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to be used to start source consumption. Eligible to be used in states:</span>
<span class="sd">        [NOT_STARTED, ENDED, (RESTARTING - which is internal state only)]</span>
<span class="sd">        End state:</span>
<span class="sd">        * INITIALISING - that should change into RUNNING once first frame is ready to be grabbed</span>
<span class="sd">        * ERROR - if it was not possible to connect with source</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">            * SourceConnectionError: if source cannot be connected</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">START_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not START stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">()</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to be used to terminate source consumption. Eligible to be used in states:</span>
<span class="sd">        [MUTED, RUNNING, PAUSED, ENDED, ERROR, (RESTARTING - which is internal state only)]</span>
<span class="sd">        End state:</span>
<span class="sd">        * ENDED - indicating success of the process</span>
<span class="sd">        * ERROR - if error with processing occurred</span>

<span class="sd">        Must be used to properly dispose resources at the end.</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Args:</span>
<span class="sd">            wait_on_frames_consumption (bool): Flag telling if all frames from buffer must be consumed before</span>
<span class="sd">                completion of this operation.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINATE_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not TERMINATE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terminate</span><span class="p">(</span>
            <span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="n">wait_on_frames_consumption</span><span class="p">,</span>
            <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="n">purge_frames_buffer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to be used to pause source consumption. During pause - no new frames are consumed.</span>
<span class="sd">        Used on on-line streams for too long may cause stream disconnection.</span>
<span class="sd">        Eligible to be used in states:</span>
<span class="sd">        [RUNNING]</span>
<span class="sd">        End state:</span>
<span class="sd">        * PAUSED</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PAUSE_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not PAUSE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pause</span><span class="p">()</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">mute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to be used to mute source consumption. Muting is an equivalent of pause for stream - where</span>
<span class="sd">        frames grabbing is not put on hold, just new frames decoding and buffering is not allowed - causing</span>
<span class="sd">        intermediate frames to be dropped. May be also used against files, although arguably less useful.</span>
<span class="sd">        Eligible to be used in states:</span>
<span class="sd">        [RUNNING]</span>
<span class="sd">        End state:</span>
<span class="sd">        * MUTED</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MUTE_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not MUTE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mute</span><span class="p">()</span>

    <span class="nd">@lock_state_transition</span>
    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to recover from pause or mute into running state.</span>
<span class="sd">        [PAUSED, MUTED]</span>
<span class="sd">        End state:</span>
<span class="sd">        * RUNNING</span>

<span class="sd">        Thread safe - only one transition of states possible at the time.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        Throws:</span>
<span class="sd">            * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RESUME_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not RESUME stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resume</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to get current state of the `VideoSource`</span>

<span class="sd">        Returns: StreamState</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="k">def</span> <span class="nf">frame_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to check if decoded frame is ready for consumer</span>

<span class="sd">        Returns: boolean flag indicating frame readiness</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method to be used by the consumer to get decoded source frame.</span>

<span class="sd">        Returns: VideoFrame object with decoded frame and its metadata.</span>
<span class="sd">        Throws:</span>
<span class="sd">            * EndOfStreamError: when trying to get the frame from closed source.</span>
<span class="sd">        """</span>
        <span class="n">video_frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">VideoFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">get_from_queue</span><span class="p">(</span>
            <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="p">,</span>
            <span class="n">on_successful_read</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">notify_frame_consumed</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">purge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="ow">is</span> <span class="n">BufferConsumptionStrategy</span><span class="o">.</span><span class="n">EAGER</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">video_frame</span> <span class="o">==</span> <span class="n">POISON_PILL</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EndOfStreamError</span><span class="p">(</span>
                <span class="s2">"Attempted to retrieve frame from stream that already ended."</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">video_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">send_video_source_status_update</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">FRAME_CONSUMED_EVENT</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"frame_timestamp"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">frame_timestamp</span><span class="p">,</span>
                    <span class="s2">"frame_id"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
                    <span class="s2">"source_id"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">video_frame</span>

    <span class="k">def</span> <span class="nf">describe_source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceMetadata</span><span class="p">:</span>
        <span class="n">serialized_source_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">serialized_source_reference</span><span class="p">):</span>
            <span class="n">serialized_source_reference</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SourceMetadata</span><span class="p">(</span>
            <span class="n">source_properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="p">,</span>
            <span class="n">source_reference</span><span class="o">=</span><span class="n">serialized_source_reference</span><span class="p">,</span>
            <span class="n">buffer_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="o">.</span><span class="n">maxsize</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
            <span class="n">buffer_filling_strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">buffer_filling_strategy</span><span class="p">,</span>
            <span class="n">buffer_consumption_strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span><span class="p">,</span>
            <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_restart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_terminate</span><span class="p">(</span>
            <span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="n">wait_on_frames_consumption</span><span class="p">,</span>
            <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="n">purge_frames_buffer</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">RESTARTING</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffering_allowed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoFrameProducer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SourceProperties</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">INITIALISING</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_video</span> <span class="o">=</span> <span class="n">CV2VideoFrameProducer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SourceConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Cannot connect to video source under reference: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream_reference</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="o">.</span><span class="n">initialize_source_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_source_properties</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="o">.</span><span class="n">discover_source_properties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">source_properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="o">.</span><span class="n">is_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_file_mode_consumption_strategies</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_stream_mode_consumption_strategies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_consume_video</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_terminate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">in</span> <span class="n">RESUME_ELIGIBLE_STATES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resume</span><span class="p">()</span>
        <span class="n">previous_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">TERMINATING</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">purge_frames_buffer</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">get_from_queue</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">purge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_thread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_consumption_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">previous_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">ENDED</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pause</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffering_allowed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">MUTED</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">previous_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">previous_state</span> <span class="ow">is</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">reset_stream_consumption_pace</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">previous_state</span> <span class="ow">is</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">MUTED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffering_allowed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_set_file_mode_consumption_strategies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="o">=</span> <span class="n">BufferConsumptionStrategy</span><span class="o">.</span><span class="n">LAZY</span>

    <span class="k">def</span> <span class="nf">_set_stream_mode_consumption_strategies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="o">=</span> <span class="n">BufferConsumptionStrategy</span><span class="o">.</span><span class="n">EAGER</span>

    <span class="k">def</span> <span class="nf">_consume_video</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">send_video_source_status_update</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">VIDEO_CONSUMPTION_STARTED_EVENT</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">"source_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Video consumption started"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">TERMINATING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">)</span>
            <span class="n">declared_source_fps</span><span class="p">,</span> <span class="n">is_video_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">declared_source_fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="o">.</span><span class="n">fps</span>
                <span class="n">is_video_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_properties</span><span class="o">.</span><span class="n">is_file</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">StreamState</span><span class="o">.</span><span class="n">TERMINATING</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_playback_allowed</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">consume_frame</span><span class="p">(</span>
                    <span class="n">video</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="p">,</span>
                    <span class="n">declared_source_fps</span><span class="o">=</span><span class="n">declared_source_fps</span><span class="p">,</span>
                    <span class="n">is_source_video_file</span><span class="o">=</span><span class="n">is_video_file</span><span class="p">,</span>
                    <span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="p">,</span>
                    <span class="n">frames_buffering_allowed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffering_allowed</span><span class="p">,</span>
                    <span class="n">source_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">POISON_PILL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">ENDED</span><span class="p">)</span>
            <span class="n">send_video_source_status_update</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">VIDEO_CONSUMPTION_FINISHED_EVENT</span><span class="p">,</span>
                <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">"source_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Video consumption finished"</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_change_state</span><span class="p">(</span><span class="n">target_state</span><span class="o">=</span><span class="n">StreamState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"source_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">,</span>
                <span class="s2">"error_type"</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">"error_message"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
                <span class="s2">"error_context"</span><span class="p">:</span> <span class="s2">"stream_consumer_thread"</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">send_video_source_status_update</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">SOURCE_ERROR_EVENT</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">"Encountered error in video consumption thread"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_change_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_state</span><span class="p">:</span> <span class="n">StreamState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"previous_state"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
            <span class="s2">"new_state"</span><span class="p">:</span> <span class="n">target_state</span><span class="p">,</span>
            <span class="s2">"source_id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">target_state</span>
        <span class="n">send_video_source_status_update</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">SOURCE_STATE_UPDATE_EVENT</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"VideoSource"</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VideoFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method allowing to use `VideoSource` convenient to read frames</span>

<span class="sd">        Returns: VideoFrame</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            source = VideoSource.init(video_reference="./some.mp4")</span>
<span class="sd">            source.start()</span>

<span class="sd">            for frame in source:</span>
<span class="sd">                 pass</span>
<span class="sd">            ```</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_frame</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">EndOfStreamError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.__next__">
<code class="highlight language-python"><span class="fm">__next__</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.__next__" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method allowing to use <code>VideoSource</code> convenient to read frames</p>
<p>Returns: VideoFrame</p>
<details class="example" open="">
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><span class="n">source</span> <span class="o">=</span> <span class="n">VideoSource</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">video_reference</span><span class="o">=</span><span class="s2">"./some.mp4"</span><span class="p">)</span>
<span class="n">source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
     <span class="k">pass</span>
</code></pre></div>
</details>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VideoFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method allowing to use `VideoSource` convenient to read frames</span>

<span class="sd">    Returns: VideoFrame</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        source = VideoSource.init(video_reference="./some.mp4")</span>
<span class="sd">        source.start()</span>

<span class="sd">        for frame in source:</span>
<span class="sd">             pass</span>
<span class="sd">        ```</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_frame</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">EndOfStreamError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.frame_ready">
<code class="highlight language-python"><span class="n">frame_ready</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.frame_ready" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to check if decoded frame is ready for consumer</p>
<p>Returns: boolean flag indicating frame readiness</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">frame_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to check if decoded frame is ready for consumer</span>

<span class="sd">    Returns: boolean flag indicating frame readiness</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.get_state">
<code class="highlight language-python"><span class="n">get_state</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.get_state" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to get current state of the <code>VideoSource</code></p>
<p>Returns: StreamState</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to get current state of the `VideoSource`</span>

<span class="sd">    Returns: StreamState</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.init">
<code class="highlight language-python"><span class="n">init</span><span class="p">(</span><span class="n">video_reference</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">,</span> <span class="n">status_update_handlers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_filling_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer_consumption_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="o">=</span><span class="n">DEFAULT_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE</span><span class="p">,</span> <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="o">=</span><span class="n">DEFAULT_ADAPTIVE_MODE_READER_PACE_TOLERANCE</span><span class="p">,</span> <span class="n">minimum_adaptive_mode_samples</span><span class="o">=</span><span class="n">DEFAULT_MINIMUM_ADAPTIVE_MODE_SAMPLES</span><span class="p">,</span> <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="o">=</span><span class="n">DEFAULT_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW</span><span class="p">,</span> <span class="n">video_source_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desired_fps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.init" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>This class is meant to represent abstraction over video sources - both video files and
on-line streams that are possible to be consumed and used by other components of <code>inference</code>
library.</p>
<p>Before digging into details of the class behaviour, it is advised to familiarise with the following
concepts and implementation assumptions:</p>
<ol>
<li>Video file can be accessed from local (or remote) storage by the consumer in a pace dictated by
    its processing capabilities. If processing is faster than the frame rate of video, operations
    may be executed in a time shorter than the time of video playback. In the opposite case - consumer
    may freely decode and process frames in its own pace, without risk for failures due to temporal
    dependencies of processing - this is classical offline processing example.</li>
<li>Video streams, on the other hand, usually need to be consumed in a pace near to their frame-rate -
    in other words - this is on-line processing example. Consumer being faster than incoming stream
    frames cannot utilise its resources to the full extent as not-yet-delivered data would be needed.
    Slow consumer, however, may not be able to process everything on time and to keep up with the pace
    of stream - some frames would need to be dropped. Otherwise - over time, consumer could go out of
    sync with the stream causing decoding failures or unpredictable behavior.</li>
</ol>
<p>To fit those two types of video sources, <code>VideoSource</code> introduces the concept of buffered decoding of
video stream (like at the YouTube - player buffers some frames that are soon to be displayed).
The way on how buffer is filled and consumed dictates the behavior of <code>VideoSource</code>.</p>
<p>Starting from <code>BufferFillingStrategy</code> - we have 3 basic options:
* WAIT: in case of slow video consumption, when buffer is full - <code>VideoSource</code> will wait for
the empty spot in buffer before next frame will be processed - this is suitable in cases when
we want to ensure EACH FRAME of the video to be processed
* DROP_OLDEST: when buffer is full, the frame that sits there for the longest time will be dropped -
this is suitable for cases when we want to process the most recent frames possible
* DROP_LATEST: when buffer is full, the newly decoded frame is dropped - useful in cases when
it is expected to have processing performance drops, but we would like to consume portions of
video that are locally smooth - but this is probably the least common use-case.</p>
<p>On top of that - there are two ADAPTIVE strategies: ADAPTIVE_DROP_OLDEST and ADAPTIVE_DROP_LATEST,
which are equivalent to DROP_OLDEST and DROP_LATEST with adaptive decoding feature enabled. The notion
of that mode will be described later.</p>
<p>Naturally, decoded frames must also be consumed. <code>VideoSource</code> provides a handy interface for reading
a video source frames by a SINGLE consumer. Consumption strategy can also be dictated via
<code>BufferConsumptionStrategy</code>:
* LAZY - consume all the frames from decoding buffer one-by-one
* EAGER - at each readout - take all frames already buffered, drop all of them apart from the most recent</p>
<p>In consequence - there are various combinations of <code>BufferFillingStrategy</code> and <code>BufferConsumptionStrategy</code>.
The most popular would be:
* <code>BufferFillingStrategy.WAIT</code> and <code>BufferConsumptionStrategy.LAZY</code> - to always decode and process each and
    every frame of the source (useful while processing video files - and default behaviour enforced by
    <code>inference</code> if there is no explicit configuration)
* <code>BufferFillingStrategy.DROP_OLDEST</code> and <code>BufferConsumptionStrategy.EAGER</code> - to always process the most
    recent frames of source (useful while processing video streams when low latency [real-time experience]
    is required - ADAPTIVE version of this is default for streams)</p>
<p>ADAPTIVE strategies were introduced to handle corner-cases, when consumer hardware is not capable to consume
video stream and process frames at the same time (for instance - Nvidia Jetson devices running processing
against hi-res streams with high FPS ratio). It acts with buffer in nearly the same way as <code>DROP_OLDEST</code>
and <code>DROP_LATEST</code> strategies, but there are two more conditions that may influence frame drop:
* announced rate of source - which in fact dictate the pace of frames grabbing from incoming stream that
MUST be met by consumer to avoid strange decoding issues causing decoder to fail - if the pace of frame grabbing
deviates too much - decoding will be postponed, and frames dropped to grab next ones sooner
* consumption rate - in resource constraints environment, not only decoding is problematic from the performance
perspective - but also heavy processing. If consumer is not quick enough - allocating more useful resources
for decoding frames that may never be processed is a waste. That's why - if decoding happens more frequently
than consumption of frame - ADAPTIVE mode causes decoding to be done in a slower pace and more frames are just
grabbed and dropped on the floor.
ADAPTIVE mode increases latency slightly, but may be the only way to operate in some cases.
Behaviour of adaptive mode, including the maximum acceptable deviations of frames grabbing pace from source,
reader pace and maximum number of consecutive frames dropped in ADAPTIVE mode are configurable by clients,
with reasonable defaults being set.</p>
<p><code>VideoSource</code> emits events regarding its activity - which can be intercepted by custom handlers. Take
into account that they are always executed in context of thread invoking them (and should be fast to complete,
otherwise may block the flow of stream consumption). All errors raised will be emitted as logger warnings only.</p>
<p><code>VideoSource</code> implementation is naturally multithreading, with different thread decoding video and different
one consuming it and manipulating source state. Implementation of user interface is thread-safe, although
stream it is meant to be consumed by a single thread only.</p>
<p>ENV variables involved:
* VIDEO_SOURCE_BUFFER_SIZE - default: 64
* VIDEO_SOURCE_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE - default: 0.1
* VIDEO_SOURCE_ADAPTIVE_MODE_READER_PACE_TOLERANCE - default: 5.0
* VIDEO_SOURCE_MINIMUM_ADAPTIVE_MODE_SAMPLES - default: 10
* VIDEO_SOURCE_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW - default: 16</p>
<p>As an <code>inference</code> user, please use .init() method instead of constructor to instantiate objects.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>video_reference</code>
</td>
<td>
<code><span title="typing.Union">Union</span>[str, int]</code>
</td>
<td>
<div class="doc-md-description">
<p>Either str with file or stream reference, or int representing device ID</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>buffer_size</code>
</td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>size of decoding buffer</p>
</div>
</td>
<td>
<code><span title="inference.core.env.DEFAULT_BUFFER_SIZE">DEFAULT_BUFFER_SIZE</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>status_update_handlers</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="inference.core.interfaces.camera.entities.StatusUpdate" href="../entities/#inference.core.interfaces.camera.entities.StatusUpdate">StatusUpdate</a>], None]]]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of handlers for status updates</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>buffer_filling_strategy</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="inference.core.interfaces.camera.video_source.BufferFillingStrategy">BufferFillingStrategy</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Settings for buffer filling strategy - if not
given - automatic choice regarding source type will be applied</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>buffer_consumption_strategy</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="inference.core.interfaces.camera.video_source.BufferConsumptionStrategy">BufferConsumptionStrategy</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Settings for buffer consumption strategy,
if not given - automatic choice regarding source type will be applied</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>adaptive_mode_stream_pace_tolerance</code>
</td>
<td>
<code>float</code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum deviation between frames grabbing pace and stream pace
that will not trigger adaptive mode frame drop</p>
</div>
</td>
<td>
<code><span title="inference.core.env.DEFAULT_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE">DEFAULT_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>adaptive_mode_reader_pace_tolerance</code>
</td>
<td>
<code>float</code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum deviation between decoding pace and stream consumption
pace that will not trigger adaptive mode frame drop</p>
</div>
</td>
<td>
<code><span title="inference.core.env.DEFAULT_ADAPTIVE_MODE_READER_PACE_TOLERANCE">DEFAULT_ADAPTIVE_MODE_READER_PACE_TOLERANCE</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>minimum_adaptive_mode_samples</code>
</td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>Minimal number of frames to be used to establish actual pace of
processing, before adaptive mode can drop any frame</p>
</div>
</td>
<td>
<code><span title="inference.core.env.DEFAULT_MINIMUM_ADAPTIVE_MODE_SAMPLES">DEFAULT_MINIMUM_ADAPTIVE_MODE_SAMPLES</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>maximum_adaptive_frames_dropped_in_row</code>
</td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of frames dropped in row due to application of
adaptive strategy</p>
</div>
</td>
<td>
<code><span title="inference.core.env.DEFAULT_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW">DEFAULT_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>video_source_properties</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[dict[str, float]]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional dictionary with video source properties
corresponding to OpenCV VideoCapture properties cv2.CAP_PROP_* to set values for the video source.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>source_id</code>
</td>
<td>
<code><span title="typing.Optional">Optional</span>[int]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional identifier of video source - mainly useful to recognise specific source
when multiple ones are in use. Identifier will be added to emitted frames and updates. It is advised
to keep it unique within all sources in use.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p>Returns: Instance of <code>VideoSource</code> class</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">init</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">video_reference</span><span class="p">:</span> <span class="n">VideoSourceIdentifier</span><span class="p">,</span>
    <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">,</span>
    <span class="n">status_update_handlers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">StatusUpdate</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">buffer_filling_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferFillingStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">buffer_consumption_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BufferConsumptionStrategy</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE</span><span class="p">,</span>
    <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ADAPTIVE_MODE_READER_PACE_TOLERANCE</span><span class="p">,</span>
    <span class="n">minimum_adaptive_mode_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_MINIMUM_ADAPTIVE_MODE_SAMPLES</span><span class="p">,</span>
    <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW</span><span class="p">,</span>
    <span class="n">video_source_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desired_fps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This class is meant to represent abstraction over video sources - both video files and</span>
<span class="sd">    on-line streams that are possible to be consumed and used by other components of `inference`</span>
<span class="sd">    library.</span>

<span class="sd">    Before digging into details of the class behaviour, it is advised to familiarise with the following</span>
<span class="sd">    concepts and implementation assumptions:</span>

<span class="sd">    1. Video file can be accessed from local (or remote) storage by the consumer in a pace dictated by</span>
<span class="sd">        its processing capabilities. If processing is faster than the frame rate of video, operations</span>
<span class="sd">        may be executed in a time shorter than the time of video playback. In the opposite case - consumer</span>
<span class="sd">        may freely decode and process frames in its own pace, without risk for failures due to temporal</span>
<span class="sd">        dependencies of processing - this is classical offline processing example.</span>
<span class="sd">    2. Video streams, on the other hand, usually need to be consumed in a pace near to their frame-rate -</span>
<span class="sd">        in other words - this is on-line processing example. Consumer being faster than incoming stream</span>
<span class="sd">        frames cannot utilise its resources to the full extent as not-yet-delivered data would be needed.</span>
<span class="sd">        Slow consumer, however, may not be able to process everything on time and to keep up with the pace</span>
<span class="sd">        of stream - some frames would need to be dropped. Otherwise - over time, consumer could go out of</span>
<span class="sd">        sync with the stream causing decoding failures or unpredictable behavior.</span>

<span class="sd">    To fit those two types of video sources, `VideoSource` introduces the concept of buffered decoding of</span>
<span class="sd">    video stream (like at the YouTube - player buffers some frames that are soon to be displayed).</span>
<span class="sd">    The way on how buffer is filled and consumed dictates the behavior of `VideoSource`.</span>

<span class="sd">    Starting from `BufferFillingStrategy` - we have 3 basic options:</span>
<span class="sd">    * WAIT: in case of slow video consumption, when buffer is full - `VideoSource` will wait for</span>
<span class="sd">    the empty spot in buffer before next frame will be processed - this is suitable in cases when</span>
<span class="sd">    we want to ensure EACH FRAME of the video to be processed</span>
<span class="sd">    * DROP_OLDEST: when buffer is full, the frame that sits there for the longest time will be dropped -</span>
<span class="sd">    this is suitable for cases when we want to process the most recent frames possible</span>
<span class="sd">    * DROP_LATEST: when buffer is full, the newly decoded frame is dropped - useful in cases when</span>
<span class="sd">    it is expected to have processing performance drops, but we would like to consume portions of</span>
<span class="sd">    video that are locally smooth - but this is probably the least common use-case.</span>

<span class="sd">    On top of that - there are two ADAPTIVE strategies: ADAPTIVE_DROP_OLDEST and ADAPTIVE_DROP_LATEST,</span>
<span class="sd">    which are equivalent to DROP_OLDEST and DROP_LATEST with adaptive decoding feature enabled. The notion</span>
<span class="sd">    of that mode will be described later.</span>

<span class="sd">    Naturally, decoded frames must also be consumed. `VideoSource` provides a handy interface for reading</span>
<span class="sd">    a video source frames by a SINGLE consumer. Consumption strategy can also be dictated via</span>
<span class="sd">    `BufferConsumptionStrategy`:</span>
<span class="sd">    * LAZY - consume all the frames from decoding buffer one-by-one</span>
<span class="sd">    * EAGER - at each readout - take all frames already buffered, drop all of them apart from the most recent</span>

<span class="sd">    In consequence - there are various combinations of `BufferFillingStrategy` and `BufferConsumptionStrategy`.</span>
<span class="sd">    The most popular would be:</span>
<span class="sd">    * `BufferFillingStrategy.WAIT` and `BufferConsumptionStrategy.LAZY` - to always decode and process each and</span>
<span class="sd">        every frame of the source (useful while processing video files - and default behaviour enforced by</span>
<span class="sd">        `inference` if there is no explicit configuration)</span>
<span class="sd">    * `BufferFillingStrategy.DROP_OLDEST` and `BufferConsumptionStrategy.EAGER` - to always process the most</span>
<span class="sd">        recent frames of source (useful while processing video streams when low latency [real-time experience]</span>
<span class="sd">        is required - ADAPTIVE version of this is default for streams)</span>

<span class="sd">    ADAPTIVE strategies were introduced to handle corner-cases, when consumer hardware is not capable to consume</span>
<span class="sd">    video stream and process frames at the same time (for instance - Nvidia Jetson devices running processing</span>
<span class="sd">    against hi-res streams with high FPS ratio). It acts with buffer in nearly the same way as `DROP_OLDEST`</span>
<span class="sd">    and `DROP_LATEST` strategies, but there are two more conditions that may influence frame drop:</span>
<span class="sd">    * announced rate of source - which in fact dictate the pace of frames grabbing from incoming stream that</span>
<span class="sd">    MUST be met by consumer to avoid strange decoding issues causing decoder to fail - if the pace of frame grabbing</span>
<span class="sd">    deviates too much - decoding will be postponed, and frames dropped to grab next ones sooner</span>
<span class="sd">    * consumption rate - in resource constraints environment, not only decoding is problematic from the performance</span>
<span class="sd">    perspective - but also heavy processing. If consumer is not quick enough - allocating more useful resources</span>
<span class="sd">    for decoding frames that may never be processed is a waste. That's why - if decoding happens more frequently</span>
<span class="sd">    than consumption of frame - ADAPTIVE mode causes decoding to be done in a slower pace and more frames are just</span>
<span class="sd">    grabbed and dropped on the floor.</span>
<span class="sd">    ADAPTIVE mode increases latency slightly, but may be the only way to operate in some cases.</span>
<span class="sd">    Behaviour of adaptive mode, including the maximum acceptable deviations of frames grabbing pace from source,</span>
<span class="sd">    reader pace and maximum number of consecutive frames dropped in ADAPTIVE mode are configurable by clients,</span>
<span class="sd">    with reasonable defaults being set.</span>

<span class="sd">    `VideoSource` emits events regarding its activity - which can be intercepted by custom handlers. Take</span>
<span class="sd">    into account that they are always executed in context of thread invoking them (and should be fast to complete,</span>
<span class="sd">    otherwise may block the flow of stream consumption). All errors raised will be emitted as logger warnings only.</span>

<span class="sd">    `VideoSource` implementation is naturally multithreading, with different thread decoding video and different</span>
<span class="sd">    one consuming it and manipulating source state. Implementation of user interface is thread-safe, although</span>
<span class="sd">    stream it is meant to be consumed by a single thread only.</span>

<span class="sd">    ENV variables involved:</span>
<span class="sd">    * VIDEO_SOURCE_BUFFER_SIZE - default: 64</span>
<span class="sd">    * VIDEO_SOURCE_ADAPTIVE_MODE_STREAM_PACE_TOLERANCE - default: 0.1</span>
<span class="sd">    * VIDEO_SOURCE_ADAPTIVE_MODE_READER_PACE_TOLERANCE - default: 5.0</span>
<span class="sd">    * VIDEO_SOURCE_MINIMUM_ADAPTIVE_MODE_SAMPLES - default: 10</span>
<span class="sd">    * VIDEO_SOURCE_MAXIMUM_ADAPTIVE_FRAMES_DROPPED_IN_ROW - default: 16</span>

<span class="sd">    As an `inference` user, please use .init() method instead of constructor to instantiate objects.</span>

<span class="sd">    Args:</span>
<span class="sd">        video_reference (Union[str, int]): Either str with file or stream reference, or int representing device ID</span>
<span class="sd">        buffer_size (int): size of decoding buffer</span>
<span class="sd">        status_update_handlers (Optional[List[Callable[[StatusUpdate], None]]]): List of handlers for status updates</span>
<span class="sd">        buffer_filling_strategy (Optional[BufferFillingStrategy]): Settings for buffer filling strategy - if not</span>
<span class="sd">            given - automatic choice regarding source type will be applied</span>
<span class="sd">        buffer_consumption_strategy (Optional[BufferConsumptionStrategy]): Settings for buffer consumption strategy,</span>
<span class="sd">            if not given - automatic choice regarding source type will be applied</span>
<span class="sd">        adaptive_mode_stream_pace_tolerance (float): Maximum deviation between frames grabbing pace and stream pace</span>
<span class="sd">            that will not trigger adaptive mode frame drop</span>
<span class="sd">        adaptive_mode_reader_pace_tolerance (float): Maximum deviation between decoding pace and stream consumption</span>
<span class="sd">            pace that will not trigger adaptive mode frame drop</span>
<span class="sd">        minimum_adaptive_mode_samples (int): Minimal number of frames to be used to establish actual pace of</span>
<span class="sd">            processing, before adaptive mode can drop any frame</span>
<span class="sd">        maximum_adaptive_frames_dropped_in_row (int): Maximum number of frames dropped in row due to application of</span>
<span class="sd">            adaptive strategy</span>
<span class="sd">        video_source_properties (Optional[dict[str, float]]): Optional dictionary with video source properties</span>
<span class="sd">            corresponding to OpenCV VideoCapture properties cv2.CAP_PROP_* to set values for the video source.</span>
<span class="sd">        source_id (Optional[int]): Optional identifier of video source - mainly useful to recognise specific source</span>
<span class="sd">            when multiple ones are in use. Identifier will be added to emitted frames and updates. It is advised</span>
<span class="sd">            to keep it unique within all sources in use.</span>

<span class="sd">    Returns: Instance of `VideoSource` class</span>
<span class="sd">    """</span>
    <span class="n">frames_buffer</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status_update_handlers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">status_update_handlers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">video_consumer</span> <span class="o">=</span> <span class="n">VideoConsumer</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
        <span class="n">buffer_filling_strategy</span><span class="o">=</span><span class="n">buffer_filling_strategy</span><span class="p">,</span>
        <span class="n">adaptive_mode_stream_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_stream_pace_tolerance</span><span class="p">,</span>
        <span class="n">adaptive_mode_reader_pace_tolerance</span><span class="o">=</span><span class="n">adaptive_mode_reader_pace_tolerance</span><span class="p">,</span>
        <span class="n">minimum_adaptive_mode_samples</span><span class="o">=</span><span class="n">minimum_adaptive_mode_samples</span><span class="p">,</span>
        <span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="o">=</span><span class="n">maximum_adaptive_frames_dropped_in_row</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="o">=</span><span class="n">status_update_handlers</span><span class="p">,</span>
        <span class="n">desired_fps</span><span class="o">=</span><span class="n">desired_fps</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">stream_reference</span><span class="o">=</span><span class="n">video_reference</span><span class="p">,</span>
        <span class="n">frames_buffer</span><span class="o">=</span><span class="n">frames_buffer</span><span class="p">,</span>
        <span class="n">status_update_handlers</span><span class="o">=</span><span class="n">status_update_handlers</span><span class="p">,</span>
        <span class="n">buffer_consumption_strategy</span><span class="o">=</span><span class="n">buffer_consumption_strategy</span><span class="p">,</span>
        <span class="n">video_consumer</span><span class="o">=</span><span class="n">video_consumer</span><span class="p">,</span>
        <span class="n">video_source_properties</span><span class="o">=</span><span class="n">video_source_properties</span><span class="p">,</span>
        <span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.mute">
<code class="highlight language-python"><span class="n">mute</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.mute" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to be used to mute source consumption. Muting is an equivalent of pause for stream - where
frames grabbing is not put on hold, just new frames decoding and buffering is not allowed - causing
intermediate frames to be dropped. May be also used against files, although arguably less useful.
Eligible to be used in states:
[RUNNING]
End state:
* MUTED</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">mute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to be used to mute source consumption. Muting is an equivalent of pause for stream - where</span>
<span class="sd">    frames grabbing is not put on hold, just new frames decoding and buffering is not allowed - causing</span>
<span class="sd">    intermediate frames to be dropped. May be also used against files, although arguably less useful.</span>
<span class="sd">    Eligible to be used in states:</span>
<span class="sd">    [RUNNING]</span>
<span class="sd">    End state:</span>
<span class="sd">    * MUTED</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MUTE_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not MUTE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mute</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.pause">
<code class="highlight language-python"><span class="n">pause</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.pause" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to be used to pause source consumption. During pause - no new frames are consumed.
Used on on-line streams for too long may cause stream disconnection.
Eligible to be used in states:
[RUNNING]
End state:
* PAUSED</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to be used to pause source consumption. During pause - no new frames are consumed.</span>
<span class="sd">    Used on on-line streams for too long may cause stream disconnection.</span>
<span class="sd">    Eligible to be used in states:</span>
<span class="sd">    [RUNNING]</span>
<span class="sd">    End state:</span>
<span class="sd">    * PAUSED</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PAUSE_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not PAUSE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pause</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.read_frame">
<code class="highlight language-python"><span class="n">read_frame</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.read_frame" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to be used by the consumer to get decoded source frame.</p>
<p>Throws:
    * EndOfStreamError: when trying to get the frame from closed source.</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to be used by the consumer to get decoded source frame.</span>

<span class="sd">    Returns: VideoFrame object with decoded frame and its metadata.</span>
<span class="sd">    Throws:</span>
<span class="sd">        * EndOfStreamError: when trying to get the frame from closed source.</span>
<span class="sd">    """</span>
    <span class="n">video_frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">VideoFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">get_from_queue</span><span class="p">(</span>
        <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frames_buffer</span><span class="p">,</span>
        <span class="n">on_successful_read</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_consumer</span><span class="o">.</span><span class="n">notify_frame_consumed</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
        <span class="n">purge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_consumption_strategy</span> <span class="ow">is</span> <span class="n">BufferConsumptionStrategy</span><span class="o">.</span><span class="n">EAGER</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">video_frame</span> <span class="o">==</span> <span class="n">POISON_PILL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">EndOfStreamError</span><span class="p">(</span>
            <span class="s2">"Attempted to retrieve frame from stream that already ended."</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">video_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">send_video_source_status_update</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">UpdateSeverity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">FRAME_CONSUMED_EVENT</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"frame_timestamp"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">frame_timestamp</span><span class="p">,</span>
                <span class="s2">"frame_id"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">frame_id</span><span class="p">,</span>
                <span class="s2">"source_id"</span><span class="p">:</span> <span class="n">video_frame</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">status_update_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_update_handlers</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">video_frame</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.restart">
<code class="highlight language-python"><span class="n">restart</span><span class="p">(</span><span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.restart" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to restart source consumption. Eligible to be used in states:
[MUTED, RUNNING, PAUSED, ENDED, ERROR].
End state:
* INITIALISING - that should change into RUNNING once first frame is ready to be grabbed
* ERROR - if it was not possible to connect with source</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>wait_on_frames_consumption</code>
</td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Flag telling if all frames from buffer must be consumed before
completion of this operation.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source
    * SourceConnectionError: if source cannot be connected</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">restart</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to restart source consumption. Eligible to be used in states:</span>
<span class="sd">    [MUTED, RUNNING, PAUSED, ENDED, ERROR].</span>
<span class="sd">    End state:</span>
<span class="sd">    * INITIALISING - that should change into RUNNING once first frame is ready to be grabbed</span>
<span class="sd">    * ERROR - if it was not possible to connect with source</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Args:</span>
<span class="sd">        wait_on_frames_consumption (bool): Flag telling if all frames from buffer must be consumed before</span>
<span class="sd">            completion of this operation.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        * SourceConnectionError: if source cannot be connected</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RESTART_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not RESTART stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_restart</span><span class="p">(</span>
        <span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="n">wait_on_frames_consumption</span><span class="p">,</span>
        <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="n">purge_frames_buffer</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.resume">
<code class="highlight language-python"><span class="n">resume</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.resume" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to recover from pause or mute into running state.
[PAUSED, MUTED]
End state:
* RUNNING</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to recover from pause or mute into running state.</span>
<span class="sd">    [PAUSED, MUTED]</span>
<span class="sd">    End state:</span>
<span class="sd">    * RUNNING</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RESUME_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not RESUME stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_resume</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.start">
<code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.start" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to be used to start source consumption. Eligible to be used in states:
[NOT_STARTED, ENDED, (RESTARTING - which is internal state only)]
End state:
* INITIALISING - that should change into RUNNING once first frame is ready to be grabbed
* ERROR - if it was not possible to connect with source</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source
    * SourceConnectionError: if source cannot be connected</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to be used to start source consumption. Eligible to be used in states:</span>
<span class="sd">    [NOT_STARTED, ENDED, (RESTARTING - which is internal state only)]</span>
<span class="sd">    End state:</span>
<span class="sd">    * INITIALISING - that should change into RUNNING once first frame is ready to be grabbed</span>
<span class="sd">    * ERROR - if it was not possible to connect with source</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">        * SourceConnectionError: if source cannot be connected</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">START_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not START stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.VideoSource.terminate">
<code class="highlight language-python"><span class="n">terminate</span><span class="p">(</span><span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.VideoSource.terminate" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Method to be used to terminate source consumption. Eligible to be used in states:
[MUTED, RUNNING, PAUSED, ENDED, ERROR, (RESTARTING - which is internal state only)]
End state:
* ENDED - indicating success of the process
* ERROR - if error with processing occurred</p>
<p>Must be used to properly dispose resources at the end.</p>
<p>Thread safe - only one transition of states possible at the time.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>wait_on_frames_consumption</code>
</td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Flag telling if all frames from buffer must be consumed before
completion of this operation.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<p>Throws:
    * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@lock_state_transition</span>
<span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">wait_on_frames_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">purge_frames_buffer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method to be used to terminate source consumption. Eligible to be used in states:</span>
<span class="sd">    [MUTED, RUNNING, PAUSED, ENDED, ERROR, (RESTARTING - which is internal state only)]</span>
<span class="sd">    End state:</span>
<span class="sd">    * ENDED - indicating success of the process</span>
<span class="sd">    * ERROR - if error with processing occurred</span>

<span class="sd">    Must be used to properly dispose resources at the end.</span>

<span class="sd">    Thread safe - only one transition of states possible at the time.</span>

<span class="sd">    Args:</span>
<span class="sd">        wait_on_frames_consumption (bool): Flag telling if all frames from buffer must be consumed before</span>
<span class="sd">            completion of this operation.</span>

<span class="sd">    Returns: None</span>
<span class="sd">    Throws:</span>
<span class="sd">        * StreamOperationNotAllowedError: if executed in context of incorrect state of the source</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TERMINATE_ELIGIBLE_STATES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">StreamOperationNotAllowedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not TERMINATE stream in state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terminate</span><span class="p">(</span>
        <span class="n">wait_on_frames_consumption</span><span class="o">=</span><span class="n">wait_on_frames_consumption</span><span class="p">,</span>
        <span class="n">purge_frames_buffer</span><span class="o">=</span><span class="n">purge_frames_buffer</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="inference.core.interfaces.camera.video_source.get_from_queue">
<code class="highlight language-python"><span class="n">get_from_queue</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_successful_read</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">purge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
<a class="headerlink" href="#inference.core.interfaces.camera.video_source.get_from_queue" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Function is supposed to take element from the queue waiting on the first element to appear using <code>timeout</code>
parameter. One may ask to go to the very last element of the queue and return it - then <code>purge</code> should be set
to True. No additional wait on new elements to appear happen and the purge stops once queue is free returning last
element consumed.
queue.task_done() and on_successful_read(...) will be called on each received element.</p>
<details class="quote">
<summary>Source code in <code>inference/core/interfaces/camera/video_source.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_from_queue</span><span class="p">(</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Queue</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_successful_read</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">purge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Function is supposed to take element from the queue waiting on the first element to appear using `timeout`</span>
<span class="sd">    parameter. One may ask to go to the very last element of the queue and return it - then `purge` should be set</span>
<span class="sd">    to True. No additional wait on new elements to appear happen and the purge stops once queue is free returning last</span>
<span class="sd">    element consumed.</span>
<span class="sd">    queue.task_done() and on_successful_read(...) will be called on each received element.</span>
<span class="sd">    """</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">purge</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
            <span class="n">on_successful_read</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span> <span class="ow">and</span> <span class="n">purge</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
        <span class="n">on_successful_read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: utils" class="md-footer__link md-footer__link--prev" href="../utils/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                utils
              </div>
</div>
</a>
<a aria-label="Next: workflows" class="md-footer__link md-footer__link--next" href="../../http/handlers/workflows/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                workflows
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Roboflow 2024. All rights reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/roboflow" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://www.youtube.com/roboflow" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/roboflow-ai/mycompany/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/roboflow" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../../../..", "features": ["navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.indexes", "navigation.sections", "content.code.copy"], "search": "../../../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 1.0}}</script>
<script src="../../../../../../../assets/javascripts/bundle.3220b9d7.min.js"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js"></script>
<script src="../../../../../../../javascript/init_kapa_widget.js"></script>
<script src="../../../../../../../javascript/cookbooks.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>